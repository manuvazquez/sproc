[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "sproc",
    "section": "",
    "text": "This is Python code meant to download and parse Spanish government’s Plataforma de contratación del sector público metadata. It produces parquet files that can be easily read in many programming languages.\nThis project was developed with nbdev, and hence each module stems from a Jupyter notebook that contains the code, along with tests and documentation. If you are interested in the inner workings of any module you can check its corresponding notebook in the corresponding section of the github pages of the project."
  },
  {
    "objectID": "index.html#install",
    "href": "index.html#install",
    "title": "sproc",
    "section": "Install",
    "text": "Install\npip install git+https://github.com/manuvazquez/sproc@main\nshould do."
  },
  {
    "objectID": "index.html#how-to-use",
    "href": "index.html#how-to-use",
    "title": "sproc",
    "section": "How to use",
    "text": "How to use\nThe software can be exploited as a library or as standalone scripts.\n\nScripts\n\nDownloading data\nsproc_update command is the work-horse of the library. It allows downloading all the data of a given kind into a parquet file, that later on can be updated invoking the same command. Running, e.g.,\nsproc_update outsiders\nwill download all the aggregated procurement data (excluding minor contracts), and write a outsiders.parquet file. Argument -o can be used to specify a directory other than the current one. Instead of outsiders, one can pass insiders or minors.\nThis is the highest-level command, and most likely the only one you need. The remaining ones (briefly explained below) provide access to finer granularity functionality.\n\n\nProcessing a single zip file\nFor testing purposes one can download Outsiders contracts for 2018, either directly by clicking this link or, if wget is available, running\nwget https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2018.zip\nRunning\nsproc_process_zip.py PlataformasAgregadasSinMenores_2018.zip 2018.parquet\noutputs the file 2018.parquet (the name being given by the 2nd argument), which contains a pd.DataFrame with all the 2018 metadata. It can be readily loaded (in Python, through Pandas’ pd.read_parquet). The columns of the pd.DataFrame stored inside are multiindexed (meaning one could get columns such as (ContractFolderStatus','ContractFolderID) and (ContractFolderStatus','ContractFolderStatusCode). This is very convenient when visualizing the data (see the the documentation for the hiermodule).\n\n\nFrom hierarchical (multiindexed) columns to plain ones\nThe columns of the above pd.DataFrame can be flattened to get, in the example above, ContractFolderStatus - ContractFolderID and ContractFolderStatus - ContractFolderStatusCode, respectively. Additionally, some renaming might be applied following the mapping in some YAML file\nsproc_rename_cols.py 2018.parquet samples/PLACE.yaml 2018_flattened.parquet\nThis would yield a pd.DataFrame with plain columns in file 2018_flattened.parquet. Renaming is carried out using the mapping in PLACE.yaml, which can be found in the samples directory of this repository.\n\n\nProcessing a list of zip files\nCommand sproc_read_zips.py can be used to batch-process a sequence of files, e.g.,\nsproc_read_zips.py contratosMenoresPerfilesContratantes_2018.zip contratosMenoresPerfilesContratantes_2019.zip\nIf no output file is specified (through the -o option), an out.parquet file (in which all the entries of all the zip files are stitched together) is produced.\n\n\nAppending new data to an existing (column-multiindexed) parquet file\nWe can append new data to an existing pd.DataFrame. Let us, for instance, download, data from January 2022,\nwget https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_202201.zip\nand extend the previous parquet file with data extracted from the newly downloaded zip,\nsproc_extend_parquet_with_zip.py 2018.parquet PlataformasAgregadasSinMenores_202201.zip 2018_202201.parquet\nThe combined data was saved in 2018_202201.parquet."
  },
  {
    "objectID": "parse.html",
    "href": "parse.html",
    "title": "parse",
    "section": "",
    "text": "Directory where the data (XML files) are stored\n\ndirectory = pathlib.Path.cwd().parent / 'samples'\nassert directory.exists()\ndirectory\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples')\n\n\nA (sample) file in that directory\n\nxml_file = directory / 'PlataformasAgregadasSinMenores_20220104_030016_1.atom'\nassert xml_file.exists()\nxml_file\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PlataformasAgregadasSinMenores_20220104_030016_1.atom')\n\n\nXML file is read into a hierarchical (column-multiindex) pd.DataFrame. CAVEAT: a hierarchical pd.DataFrame is assumed.\n\ndf = sproc.hier.flat_df_to_multiindexed_df(sproc.xml.to_curated_df(xml_file))\ndf.head()\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      TechnicalDocumentReference\n      ProcurementProject\n      LocatedContractingParty\n      TenderingProcess\n      TenderResult\n      TenderingProcess\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      ID\n      Attachment\n      PlannedPeriod\n      Party\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      AwardedTenderedProject\n      TenderSubmissionDeadlinePeriod\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      \n      ExternalReference\n      StartDate\n      EndDate\n      PartyIdentification\n      ParentLocatedParty\n      EndDate\n      EndTime\n      ProcurementProjectLotID\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      URI\n      \n      \n      ID\n      PartyName\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03 00:11:41.826000+00:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2021-12-17 14:00:00+00:00\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03 00:00:11.194000+00:00\n      8128_3/2021\n      PUB\n      <NA>\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-22 23:30:00+00:00\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03 00:00:10.399000+00:00\n      1000_0005-CP01-2021-000063\n      EV\n      <NA>\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-02 23:11:40.740000+00:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-02 23:59:00+00:00\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-02 23:11:40.696000+00:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-02 23:59:00+00:00\n    \n  \n\n5 rows × 39 columns\n\n\n\nThe column to discriminate regions\nIt is turned\n\ndomain_discriminative_columns = [sproc.hier.pad_col_levels(df, p) for p in domain_discriminative_columns_paths]\ndomain_discriminative_columns\n\n[('ContractFolderStatus',\n  'LocatedContractingParty',\n  'BuyerProfileURIID',\n  '',\n  '',\n  ''),\n ('ContractFolderStatus',\n  'LegalDocumentReference',\n  'Attachment',\n  'ExternalReference',\n  'URI',\n  '')]\n\n\nUnique values of the first one\n\nunique_values = df[domain_discriminative_columns[0]].unique().tolist()\nunique_values[:5]\n\n['https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=2763318',\n <NA>,\n 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=29178875',\n 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=8530338',\n 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=16054009']\n\n\npd.NA values are filtered out\n\nunique_values = list(filter(pd.notna, unique_values))\nunique_values[:5]\n\n['https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=2763318',\n 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=29178875',\n 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=8530338',\n 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=16054009',\n 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=15937468']\n\n\nA one-liner returning a pd.DataFrame of columns with parsed domains\n\ndomains = df[domain_discriminative_columns].applymap(lambda x: urllib.parse.urlparse(x).netloc if pd.notna(x) else pd.NA)\ndomains\n\n\n\n\n\n  \n    \n      \n      ContractFolderStatus\n    \n    \n      \n      LocatedContractingParty\n      LegalDocumentReference\n    \n    \n      \n      BuyerProfileURIID\n      Attachment\n    \n    \n      \n      \n      ExternalReference\n    \n    \n      \n      \n      URI\n    \n    \n      \n      \n      \n    \n  \n  \n    \n      0\n      contractaciopublica.gencat.cat\n      <NA>\n    \n    \n      1\n      <NA>\n      <NA>\n    \n    \n      2\n      <NA>\n      <NA>\n    \n    \n      3\n      contractaciopublica.gencat.cat\n      contractaciopublica.gencat.cat\n    \n    \n      4\n      contractaciopublica.gencat.cat\n      contractaciopublica.gencat.cat\n    \n    \n      ...\n      ...\n      ...\n    \n    \n      112\n      NaN\n      NaN\n    \n    \n      113\n      NaN\n      NaN\n    \n    \n      114\n      NaN\n      NaN\n    \n    \n      115\n      NaN\n      NaN\n    \n    \n      116\n      NaN\n      NaN\n    \n  \n\n117 rows × 2 columns\n\n\n\nHow many non-nulls are in every column?\n\ndomains.notna().sum()\n\nContractFolderStatus  LocatedContractingParty  BuyerProfileURIID                              42\n                      LegalDocumentReference   Attachment         ExternalReference  URI      70\ndtype: int64\n\n\nWhat about the combination?\n\ndomains[domain_discriminative_columns[0]].combine_first(domains[domain_discriminative_columns[1]]).notna().sum()\n\n77\n\n\nA function returning a pd.Series with domains\n\nsource\n\n\n\n domain (df:pandas.core.frame.DataFrame)\n\nExtract the (internet) domains from the given data\n\n\n\n\nType\nDetails\n\n\n\n\ndf\nDataFrame\nInput\n\n\nReturns\nSeries\nDomains\n\n\n\nThe function adds a new column to the pd.DataFrame inplace\n\ndomain(df)\n\n0      contractaciopublica.gencat.cat\n1                                <NA>\n2                                <NA>\n3      contractaciopublica.gencat.cat\n4      contractaciopublica.gencat.cat\n                    ...              \n112                              <NA>\n113                              <NA>\n114                              <NA>\n115                              <NA>\n116                              <NA>\nName: (ContractFolderStatus, LocatedContractingParty, BuyerProfileURIID, , , ), Length: 117, dtype: object"
  },
  {
    "objectID": "parse.html#dates",
    "href": "parse.html#dates",
    "title": "parse",
    "section": "Dates",
    "text": "Dates\nA function to parse a string containing either a year or a year and a month\n\nsource\n\nyear_and_maybe_month\n\n year_and_maybe_month (s:str)\n\n\n\n\n\nType\nDetails\n\n\n\n\ns\nstr\nRaw date\n\n\nReturns\ndatetime\nParsed date\n\n\n\nOnly a year\n\nyear_and_maybe_month('2021')\n\ndatetime.datetime(2021, 12, 1, 0, 0)\n\n\nA year and a month\n\nyear_and_maybe_month('202205')\n\ndatetime.datetime(2022, 1, 5, 0, 0)"
  },
  {
    "objectID": "assemble.html",
    "href": "assemble.html",
    "title": "assemble",
    "section": "",
    "text": "from IPython.core.debugger import set_trace\nThis imports are only meant for testing\nDirectory where the zip files are stored"
  },
  {
    "objectID": "assemble.html#parameters",
    "href": "assemble.html#parameters",
    "title": "assemble",
    "section": "Parameters",
    "text": "Parameters\nA (sample) file in that directory\n\ninput_file = directory / 'PlataformasAgregadasSinMenores_202201_05-06.zip'\nassert input_file.exists()\ninput_file\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PlataformasAgregadasSinMenores_202201_05-06.zip')\n\n\nIt is parsed and turned into a column-multiindexed pd.DataFrame\n\nflat_df = sproc.bundle.read_zip(input_file, concatenate=True)\ndf = sproc.hier.flat_df_to_multiindexed_df(flat_df)\ndf.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      LegalDocumentReference\n      ProcurementProject\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      PlannedPeriod\n      ID\n      Attachment\n      PlannedPeriod\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      StartDate\n      \n      ExternalReference\n      EndDate\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      \n      URI\n      \n      \n      URI\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021039438; Órgano de Contratac...\n      L'objecte és la contractació del servei de bug...\n      2022-01-04 12:12:09.464000+00:00\n      2021039438\n      RES\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Girona\n      Entitats municipals de Catalunya\n      L'objecte és la contractació del servei de bug...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-12-13 23:59:00+00:00\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021_2568; Órgano de Contrataci...\n      Servei comunicacions postals de l'Ajuntament d...\n      2022-01-04 12:12:09.400000+00:00\n      2021_2568\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Collbató\n      Entitats municipals de Catalunya\n      Servei comunicacions postals de l'Ajuntament d...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-29 23:59:00+00:00\n    \n  \n\n2 rows × 39 columns\n\n\n\nThe last few columns\n\ndf.columns[-2:]\n\nMultiIndex([('ContractFolderStatus', 'TenderingProcess', ...),\n            ('ContractFolderStatus', 'TenderingProcess', ...)],\n           )\n\n\nDeleted contracts are extracted\n\ndeleted_series = sproc.bundle.read_deleted_zip(input_file)\ndeleted_series.head(2)\n\nzip                                              file name                                            id                                                                                 \nPlataformasAgregadasSinMenores_202201_05-06.zip  PlataformasAgregadasSinMenores_20220105_030012.atom  https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6724977   2022-01-04 00:12:01.376000+00:00\n                                                                                                      https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968315   2022-01-03 23:11:57.567000+00:00\nName: deleted_on, dtype: datetime64[ns, UTC]"
  },
  {
    "objectID": "assemble.html#handling-deleted-entries",
    "href": "assemble.html#handling-deleted-entries",
    "title": "assemble",
    "section": "Handling deleted entries",
    "text": "Handling deleted entries\nA function to merge together a pd.DataFrame with the actual data and a pd.Series like the one shown meant to flag some entries as deleted. Ultimately, a new a column, deleted_on, is added to the former. It can either contain a date or pd.NaT if the corresponding entry was not deleted.\n\nsource\n\nmerge_deleted\n\n merge_deleted (data_df:pandas.core.frame.DataFrame,\n                deleted_series:pandas.core.series.Series)\n\n\nmerged_df = merge_deleted(df, deleted_series)\nmerged_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      ProcurementProject\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      ID\n      Attachment\n      PlannedPeriod\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      \n      ExternalReference\n      EndDate\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      URI\n      \n      \n      URI\n      PartyName\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021039438; Órgano de Contratac...\n      L'objecte és la contractació del servei de bug...\n      2022-01-04 12:12:09.464000+00:00\n      2021039438\n      RES\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Girona\n      Entitats municipals de Catalunya\n      L'objecte és la contractació del servei de bug...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-12-13 23:59:00+00:00\n      NaT\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021_2568; Órgano de Contrataci...\n      Servei comunicacions postals de l'Ajuntament d...\n      2022-01-04 12:12:09.400000+00:00\n      2021_2568\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Collbató\n      Entitats municipals de Catalunya\n      Servei comunicacions postals de l'Ajuntament d...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-29 23:59:00+00:00\n      NaT\n    \n  \n\n2 rows × 40 columns\n\n\n\nFor column-wise flat pd.DataFrames\n\nmerge_deleted(flat_df, deleted_series).head(2)\n\n\n\n\n\n  \n    \n      \n      \n      id\n      zip\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - ID\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod\n      deleted_on\n    \n    \n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      Id licitación: 2021039438; Órgano de Contratac...\n      L'objecte és la contractació del servei de bug...\n      2022-01-04 12:12:09.464000+00:00\n      2021039438\n      RES\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Girona\n      Entitats municipals de Catalunya\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-12-13 23:59:00+00:00\n      NaT\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      Id licitación: 2021_2568; Órgano de Contrataci...\n      Servei comunicacions postals de l'Ajuntament d...\n      2022-01-04 12:12:09.400000+00:00\n      2021_2568\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Collbató\n      Entitats municipals de Catalunya\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-29 23:59:00+00:00\n      NaT\n    \n  \n\n2 rows × 41 columns\n\n\n\nThe last column is the new one added\n\nmerged_df.iloc[:, -2:]\n\n\n\n\n\n  \n    \n      \n      \n      ContractFolderStatus\n      deleted_on\n    \n    \n      \n      \n      TenderingProcess\n      \n    \n    \n      \n      \n      TenderSubmissionDeadlinePeriod\n      \n    \n    \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n    \n    \n      file name\n      entry\n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      0\n      2021-12-13 23:59:00+00:00\n      NaT\n    \n    \n      1\n      2021-11-29 23:59:00+00:00\n      NaT\n    \n    \n      2\n      2021-12-20 14:00:00+00:00\n      NaT\n    \n    \n      3\n      2021-10-22 14:00:00+00:00\n      NaT\n    \n    \n      4\n      2021-11-30 18:00:00+00:00\n      NaT\n    \n    \n      ...\n      ...\n      ...\n      ...\n    \n    \n      PlataformasAgregadasSinMenores_20220106_030013.atom\n      471\n      2022-01-19 15:00:00+00:00\n      NaT\n    \n    \n      472\n      2021-05-07 15:00:00+00:00\n      NaT\n    \n    \n      473\n      2021-06-30 23:59:00+00:00\n      NaT\n    \n    \n      474\n      2021-12-13 13:00:00+00:00\n      NaT\n    \n    \n      475\n      2021-11-10 18:00:00+00:00\n      NaT\n    \n  \n\n951 rows × 2 columns\n\n\n\nThe new merged pd.DataFrame has the same number of rows as the original one\n\nassert len(df) == len(merged_df)\n\nHow many entries have been deleted?\n\nmerged_df['deleted_on'].notna().sum()\n\n0"
  },
  {
    "objectID": "assemble.html#saving-to-parquet",
    "href": "assemble.html#saving-to-parquet",
    "title": "assemble",
    "section": "Saving to parquet",
    "text": "Saving to parquet\nIn order to save a pd.DataFrame in a parquet file, some conditions must be met:\n\nif some column contains a list, then every element in that columns must also be a list (of a single element if necessary)\nthe elements of the lists in any column must be of the same type\nall of the lists across a given column must have elements of the same type\n\n\nsource\n\nparquet_amenable\n\n parquet_amenable (df:pandas.core.frame.DataFrame, inplace:bool=False)\n\n\nparquet_df = parquet_amenable(df)\nparquet_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      LegalDocumentReference\n      ProcurementProject\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      PlannedPeriod\n      ID\n      Attachment\n      PlannedPeriod\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      StartDate\n      \n      ExternalReference\n      EndDate\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      \n      URI\n      \n      \n      URI\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021039438; Órgano de Contratac...\n      L'objecte és la contractació del servei de bug...\n      2022-01-04 12:12:09.464000+00:00\n      2021039438\n      RES\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Girona\n      Entitats municipals de Catalunya\n      L'objecte és la contractació del servei de bug...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-12-13 23:59:00+00:00\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021_2568; Órgano de Contrataci...\n      Servei comunicacions postals de l'Ajuntament d...\n      2022-01-04 12:12:09.400000+00:00\n      2021_2568\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Collbató\n      Entitats municipals de Catalunya\n      Servei comunicacions postals de l'Ajuntament d...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-29 23:59:00+00:00\n    \n  \n\n2 rows × 39 columns"
  },
  {
    "objectID": "assemble.html#concatenating-dataframes",
    "href": "assemble.html#concatenating-dataframes",
    "title": "assemble",
    "section": "Concatenating dataframes",
    "text": "Concatenating dataframes\nConcatenating pd.DataFrames with the same number of levels in the columns is fine\n\npd.concat((df.iloc[:2], df.iloc[2:4]), axis=0).head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      LegalDocumentReference\n      ProcurementProject\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      PlannedPeriod\n      ID\n      Attachment\n      PlannedPeriod\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      StartDate\n      \n      ExternalReference\n      EndDate\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      \n      URI\n      \n      \n      URI\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021039438; Órgano de Contratac...\n      L'objecte és la contractació del servei de bug...\n      2022-01-04 12:12:09.464000+00:00\n      2021039438\n      RES\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Girona\n      Entitats municipals de Catalunya\n      L'objecte és la contractació del servei de bug...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-12-13 23:59:00+00:00\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021_2568; Órgano de Contrataci...\n      Servei comunicacions postals de l'Ajuntament d...\n      2022-01-04 12:12:09.400000+00:00\n      2021_2568\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Collbató\n      Entitats municipals de Catalunya\n      Servei comunicacions postals de l'Ajuntament d...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-29 23:59:00+00:00\n    \n  \n\n2 rows × 39 columns\n\n\n\nLet us build a dummy pd.DataFrame with multiindexes for both rows and columns\n\ndummy_df = pd.DataFrame(\n    np.random.rand(2, 4),\n    columns=pd.MultiIndex.from_product([['a', 'b'], range(1, 3)]),\n    index=pd.MultiIndex.from_tuples([('file.zip', 'foo.atom', 1), ('file.zip', 'fee.atom', 2)], names=['zip', 'file name', 'entry']))\ndummy_df\n\n\n\n\n\n  \n    \n      \n      \n      \n      a\n      b\n    \n    \n      \n      \n      \n      1\n      2\n      1\n      2\n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n    \n  \n  \n    \n      file.zip\n      foo.atom\n      1\n      0.271482\n      0.150680\n      0.946666\n      0.997345\n    \n    \n      fee.atom\n      2\n      0.839853\n      0.243164\n      0.199644\n      0.984693\n    \n  \n\n\n\n\nThis new dummy pd.DataFrame and the one above cannot be stacked together as they are because they have different number of levels in the columns\n\ntry:\n    pd.concat((df, dummy_df), axis=0)\nexcept ValueError:\n    print(f'{df.columns.nlevels=}, {dummy_df.columns.nlevels=}')\n\ndf.columns.nlevels=6, dummy_df.columns.nlevels=2\n\n\nThe resulting pd.DataFrame must have the larger number of levels\n\nres_n_levels = max(df.columns.nlevels, dummy_df.columns.nlevels)\nres_n_levels\n\n6\n\n\nThen we need to complement the names of the columns for the shallower pd.DataFrame\n\nnew_names = []\n\nfor c in dummy_df.columns:\n    new_names.append(c + ('',) * (res_n_levels - dummy_df.columns.nlevels))\n    \nprint(new_names)\n\n[('a', 1, '', '', '', ''), ('a', 2, '', '', '', ''), ('b', 1, '', '', '', ''), ('b', 2, '', '', '', '')]\n\n\nA new padded pd.DataFrame is built out of the dummy\n\npadded_dummy_df = dummy_df.copy()\npadded_dummy_df.columns = pd.MultiIndex.from_tuples(new_names)\npadded_dummy_df.columns.nlevels\n\n6\n\n\nNow it’s fine to concatenate both pd.DataFrames\n\npd.concat((df, padded_dummy_df), axis=0).tail(3)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      a\n      b\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      1\n      2\n      1\n      2\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      URI\n      PartyName\n      \n      \n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      Name\n      \n      \n      \n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220106_030013.atom\n      475\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: CONTR/2021/000000137; Órgano de...\n      Servei de redacció del Projecte Executiu d'obr...\n      2022-01-04 12:12:09.536000+00:00\n      CONTR/2021/000000137\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Institut d'Assistència Sanitària (IAS)\n      Departaments i Sector Públic de la Generalitat\n      Servei de redacció del Projecte Executiu d'obr...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-10 18:00:00+00:00\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      file.zip\n      foo.atom\n      1\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      0.271482\n      0.150680\n      0.946666\n      0.997345\n    \n    \n      fee.atom\n      2\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      0.839853\n      0.243164\n      0.199644\n      0.984693\n    \n  \n\n3 rows × 43 columns\n\n\n\nThe above steps are summarized in a new function.\n\nsource\n\nstack\n\n stack (top_df:pandas.core.frame.DataFrame,\n        bottom_df:pandas.core.frame.DataFrame)\n\nAbove df and the dummy one are stacked together\n\nstack(df, dummy_df).tail(3)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      a\n      b\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      1\n      2\n      1\n      2\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      URI\n      PartyName\n      \n      \n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      Name\n      \n      \n      \n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220106_030013.atom\n      475\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: CONTR/2021/000000137; Órgano de...\n      Servei de redacció del Projecte Executiu d'obr...\n      2022-01-04 12:12:09.536000+00:00\n      CONTR/2021/000000137\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Institut d'Assistència Sanitària (IAS)\n      Departaments i Sector Públic de la Generalitat\n      Servei de redacció del Projecte Executiu d'obr...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-10 18:00:00+00:00\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      file.zip\n      foo.atom\n      1\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      0.271482\n      0.150680\n      0.946666\n      0.997345\n    \n    \n      fee.atom\n      2\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      0.839853\n      0.243164\n      0.199644\n      0.984693\n    \n  \n\n3 rows × 43 columns\n\n\n\n…in a different order\n\nstack(dummy_df, df).head(3)\n\n\n\n\n\n  \n    \n      \n      \n      \n      a\n      b\n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      1\n      2\n      1\n      2\n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      ...\n      ProcurementProject\n      LegalDocumentReference\n      ProcurementProject\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      PlannedPeriod\n      ID\n      Attachment\n      PlannedPeriod\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      StartDate\n      \n      ExternalReference\n      EndDate\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      URI\n      \n      \n      URI\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      file.zip\n      foo.atom\n      1\n      0.271482\n      0.150680\n      0.946666\n      0.997345\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      <NA>\n      <NA>\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaT\n    \n    \n      fee.atom\n      2\n      0.839853\n      0.243164\n      0.199644\n      0.984693\n      <NA>\n      <NA>\n      <NA>\n      NaT\n      <NA>\n      <NA>\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaT\n    \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      0\n      NaN\n      NaN\n      NaN\n      NaN\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021039438; Órgano de Contratac...\n      L'objecte és la contractació del servei de bug...\n      2022-01-04 12:12:09.464000+00:00\n      2021039438\n      RES\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-12-13 23:59:00+00:00\n    \n  \n\n3 rows × 43 columns"
  },
  {
    "objectID": "assemble.html#processing-a-zip",
    "href": "assemble.html#processing-a-zip",
    "title": "assemble",
    "section": "Processing a zip",
    "text": "Processing a zip\nA convenience function to streamline a common procedure to process data in zip files\n\nsource\n\ndistilled_data_from_zip\n\n distilled_data_from_zip (zip_file:pathlib.Path|str)\n\n\ndistilled_df, distilled_series = distilled_data_from_zip(input_file)\n\n\ndistilled_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      LegalDocumentReference\n      ProcurementProject\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      PlannedPeriod\n      ID\n      Attachment\n      PlannedPeriod\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      StartDate\n      \n      ExternalReference\n      EndDate\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      \n      URI\n      \n      \n      URI\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220105_030012.atom\n      474\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 15/2021; Órgano de Contratació...\n      “Reforestación de 8,8 HA en el paraje “MONTAÑO...\n      2022-01-03 12:56:20.849000+00:00\n      15/2021\n      EV\n      <NA>\n      Junta de Gobierno Local\n      Ayuntamiento de Zierbena\n      “Reforestación de 8,8 HA en el paraje “MONTAÑO...\n      ...\n      <NA>\n      3 Pliego admvo Reforestación Montaño Publicaci...\n      https://www.contratacion.euskadi.eus/ac70cPubl...\n      <NA>\n      Obra repoblación Montaño - MUP 66 Publicado.pdf\n      https://www.contratacion.euskadi.eus/ac70cPubl...\n      Ayuntamiento de Zierbena\n      <NA>\n      <NA>\n      2021-12-07 13:00:00+00:00\n    \n    \n      473\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021/CO_ASER/0120; Órgano de C...\n      Formación a personas emprendedoras\n      2022-01-03 12:56:20.897000+00:00\n      2021/CO_ASER/0120\n      EV\n      <NA>\n      Concejala-Delegada del Departamento de Promoci...\n      Ayuntamiento de Vitoria-Gasteiz\n      Formación a personas emprendedoras\n      ...\n      <NA>\n      ASER0120_Pliego_Clausulas_Administrativas_Part...\n      https://www.contratacion.euskadi.eus/ac70cPubl...\n      <NA>\n      ASER0120_Pliego_Prescripciones_Tecnicas_Partic...\n      https://www.contratacion.euskadi.eus/ac70cPubl...\n      Ayuntamiento de Vitoria-Gasteiz\n      <NA>\n      <NA>\n      2021-11-26 13:00:00+00:00\n    \n  \n\n2 rows × 39 columns\n\n\n\n\ndistilled_series.head(2)\n\nzip                                              file name                                            id                                                                                 \nPlataformasAgregadasSinMenores_202201_05-06.zip  PlataformasAgregadasSinMenores_20220105_030012.atom  https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6724977   2022-01-04 00:12:01.376000+00:00\n                                                                                                      https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968315   2022-01-03 23:11:57.567000+00:00\nName: deleted_on, dtype: datetime64[ns, UTC]"
  },
  {
    "objectID": "assemble.html#completeness",
    "href": "assemble.html#completeness",
    "title": "assemble",
    "section": "Completeness",
    "text": "Completeness\nIt computes the filling ratio of every identified administration for every column. Non-identified administration will be gathered together in a NaN domain.\n\nsource\n\nsparsity\n\n sparsity (df:pandas.core.frame.DataFrame, tidy_up:bool=False,\n           do_not_modify_input:bool=True)\n\nRatio of completeness for every (identified) administration\n\nsparsity(df)\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      LegalDocumentReference\n      ProcurementProject\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      PlannedPeriod\n      ID\n      Attachment\n      PlannedPeriod\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      StartDate\n      \n      ExternalReference\n      EndDate\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      \n      \n      URI\n      \n      \n      URI\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n    \n      domain\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      contractaciopublica.gencat.cat\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.000000\n      1.0\n      ...\n      0.121622\n      0.353604\n      0.353604\n      0.121622\n      0.317568\n      0.317568\n      0.000000\n      0.000000\n      0.000000\n      0.934685\n    \n    \n      www.bilbao.eus\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      0.0\n      1.0\n      1.000000\n      1.0\n      ...\n      0.000000\n      1.000000\n      1.000000\n      0.000000\n      0.666667\n      0.666667\n      0.000000\n      1.000000\n      1.000000\n      1.000000\n    \n    \n      www.contratacion.euskadi.eus\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      0.0\n      1.0\n      1.000000\n      1.0\n      ...\n      0.062500\n      1.000000\n      1.000000\n      0.062500\n      0.906250\n      0.906250\n      1.000000\n      0.000000\n      0.000000\n      0.979167\n    \n    \n      www.contratosdegalicia.gal\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      0.000000\n      1.0\n      ...\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      1.000000\n    \n    \n      www.larioja.org\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.000000\n      1.0\n      ...\n      0.750000\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      0.000000\n      0.500000\n      0.000000\n      0.000000\n      1.000000\n    \n    \n      www.madrid.org\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      0.747826\n      1.0\n      ...\n      0.000000\n      1.000000\n      1.000000\n      0.000000\n      0.947826\n      0.947826\n      0.400000\n      0.000000\n      0.000000\n      0.252174\n    \n    \n      NaN\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      1.0\n      0.0\n      1.0\n      1.000000\n      1.0\n      ...\n      0.034483\n      0.000000\n      0.000000\n      0.034483\n      0.000000\n      0.000000\n      0.006897\n      0.055172\n      0.055172\n      0.910345\n    \n  \n\n7 rows × 39 columns\n\n\n\nThe tidied-up version\n\nsparsity(df, tidy_up=True)\n\n\n\n\n\n  \n    \n      \n      \n      \n      \n      \n      domain\n      contractaciopublica.gencat.cat\n      www.bilbao.eus\n      www.contratacion.euskadi.eus\n      www.contratosdegalicia.gal\n      www.larioja.org\n      www.madrid.org\n      NaN\n    \n  \n  \n    \n      ContractFolderStatus\n      ContractFolderID\n      \n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      ContractFolderStatusCode\n      \n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      LegalDocumentReference\n      Attachment\n      ExternalReference\n      URI\n      \n      0.353604\n      1.000000\n      1.000000\n      0.000000\n      0.000\n      1.000000\n      0.000000\n    \n    \n      ID\n      \n      \n      \n      0.353604\n      1.000000\n      1.000000\n      0.000000\n      0.000\n      1.000000\n      0.000000\n    \n    \n      LocatedContractingParty\n      BuyerProfileURIID\n      \n      \n      \n      1.000000\n      0.000000\n      0.000000\n      1.000000\n      1.000\n      1.000000\n      0.000000\n    \n    \n      ParentLocatedParty\n      ParentLocatedParty\n      PartyName\n      Name\n      0.000000\n      0.000000\n      1.000000\n      0.000000\n      0.500\n      0.400000\n      0.006897\n    \n    \n      PartyName\n      Name\n      \n      1.000000\n      1.000000\n      1.000000\n      0.000000\n      1.000\n      0.747826\n      1.000000\n    \n    \n      Party\n      PartyIdentification\n      ID\n      \n      0.000000\n      0.000000\n      0.000000\n      1.000000\n      0.000\n      0.000000\n      0.000000\n    \n    \n      PartyName\n      Name\n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      ProcurementProject\n      BudgetAmount\n      EstimatedOverallContractAmount\n      \n      \n      1.000000\n      1.000000\n      0.979167\n      0.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      TaxExclusiveAmount\n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      Name\n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      PlannedPeriod\n      DurationMeasure\n      \n      \n      0.878378\n      1.000000\n      0.937500\n      0.590909\n      1.000\n      1.000000\n      0.862069\n    \n    \n      EndDate\n      \n      \n      0.121622\n      0.000000\n      0.062500\n      0.000000\n      0.000\n      0.000000\n      0.034483\n    \n    \n      StartDate\n      \n      \n      0.121622\n      0.000000\n      0.062500\n      0.000000\n      0.750\n      0.000000\n      0.034483\n    \n    \n      RealizedLocation\n      CountrySubentityCode\n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      RequiredCommodityClassification\n      ItemClassificationCode\n      \n      \n      0.997748\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      TypeCode\n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      TechnicalDocumentReference\n      Attachment\n      ExternalReference\n      URI\n      \n      0.317568\n      0.666667\n      0.906250\n      0.000000\n      0.000\n      0.947826\n      0.000000\n    \n    \n      ID\n      \n      \n      \n      0.317568\n      0.666667\n      0.906250\n      0.000000\n      0.000\n      0.947826\n      0.000000\n    \n    \n      TenderResult\n      AwardedTenderedProject\n      LegalMonetaryTotal\n      TaxExclusiveAmount\n      \n      0.621622\n      0.000000\n      0.385417\n      0.590909\n      0.750\n      0.495652\n      0.524138\n    \n    \n      ProcurementProjectLotID\n      \n      \n      0.103604\n      0.000000\n      0.000000\n      0.272727\n      0.125\n      0.060870\n      0.213793\n    \n    \n      ReceivedTenderQuantity\n      \n      \n      \n      0.644144\n      0.000000\n      0.406250\n      0.590909\n      0.750\n      0.495652\n      0.537931\n    \n    \n      ResultCode\n      \n      \n      \n      0.644144\n      0.000000\n      0.406250\n      0.590909\n      0.750\n      0.495652\n      0.537931\n    \n    \n      WinningParty\n      PartyIdentification\n      ID\n      \n      0.621622\n      0.000000\n      0.385417\n      0.545455\n      0.750\n      0.495652\n      0.524138\n    \n    \n      PartyName\n      Name\n      \n      0.621622\n      0.000000\n      0.385417\n      0.545455\n      0.750\n      0.495652\n      0.524138\n    \n    \n      TenderingProcess\n      ParticipationRequestReceptionPeriod\n      EndDate\n      \n      \n      0.000000\n      1.000000\n      0.000000\n      0.000000\n      0.000\n      0.000000\n      0.055172\n    \n    \n      EndTime\n      \n      \n      0.000000\n      1.000000\n      0.000000\n      0.000000\n      0.000\n      0.000000\n      0.055172\n    \n    \n      ProcedureCode\n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      TenderSubmissionDeadlinePeriod\n      \n      \n      \n      0.934685\n      1.000000\n      0.979167\n      1.000000\n      1.000\n      0.252174\n      0.910345\n    \n    \n      EndDate\n      \n      \n      0.934685\n      1.000000\n      0.979167\n      1.000000\n      1.000\n      0.252174\n      0.910345\n    \n    \n      EndTime\n      \n      \n      0.934685\n      1.000000\n      0.979167\n      1.000000\n      1.000\n      0.252174\n      0.910345\n    \n    \n      ValidNoticeInfo\n      AdditionalPublicationStatus\n      AdditionalPublicationDocumentReference\n      IssueDate\n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      PublicationMediaName\n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      NoticeTypeCode\n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      id\n      \n      \n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      summary\n      \n      \n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      title\n      \n      \n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n    \n      updated\n      \n      \n      \n      \n      \n      1.000000\n      1.000000\n      1.000000\n      1.000000\n      1.000\n      1.000000\n      1.000000\n    \n  \n\n\n\n\nIf we set to False the do_not_modify_input parameter, then a new domain column is added to the input pd.DataFrame. By default, it’s not there.\n\n'domain' in df.columns\n\nFalse\n\n\n\nsparsity(df, do_not_modify_input=False)\n'domain' in df.columns\n\nTrue"
  },
  {
    "objectID": "xml.html",
    "href": "xml.html",
    "title": "xml",
    "section": "",
    "text": "Directory where the data (XML files) are stored\n\ndirectory = pathlib.Path.cwd().parent / 'samples'\nassert directory.exists()\ndirectory\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples')\n\n\nA (sample) file in that directory\n\nxml_file = directory / 'PlataformasAgregadasSinMenores_20220104_030016_1.atom'\nassert xml_file.exists()\nxml_file\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PlataformasAgregadasSinMenores_20220104_030016_1.atom')\n\n\n\n!head {xml_file} --lines=20\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<feed xmlns=\"http://www.w3.org/2005/Atom\" xmlns:cbc-place-ext=\"urn:dgpe:names:draft:codice-place-ext:schema:xsd:CommonBasicComponents-2\" xmlns:cac-place-ext=\"urn:dgpe:names:draft:codice-place-ext:schema:xsd:CommonAggregateComponents-2\" xmlns:cbc=\"urn:dgpe:names:draft:codice:schema:xsd:CommonBasicComponents-2\" xmlns:cac=\"urn:dgpe:names:draft:codice:schema:xsd:CommonAggregateComponents-2\" xmlns:ns1=\"urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2\">\n    <author>\n        <name>Plataforma de Contratación del Sector Público</name>\n        <uri>https://contrataciondelestado.es</uri>\n        <email>contrataciondelestado@minhafp.es</email>\n    </author>\n    <id>https://contrataciondelestado.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores.atom</id>\n    <link href=\"PlataformasAgregadasSinMenores_20220104_030016_1.atom\" rel=\"self\"/>\n    <link href=\"PlataformasAgregadasSinMenores.atom\" rel=\"first\"/>\n    <link href=\"PlataformasAgregadasSinMenores_20220104_030016.atom\" rel=\"prev\"/>\n    <link href=\"PlataformasAgregadasSinMenores_20211231_030012.atom\" rel=\"next\"/>\n    <title>Licitaciones publicadas en la Plataforma de Contratación del Sector Público: Plataformas Agregadas Sin Menores</title>\n    <updated>2022-01-03T03:00:13.633+01:00</updated>\n    <at:deleted-entry ref=\"https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968384\" when=\"2022-01-03T00:11:41.879+01:00\" xmlns:at=\"http://purl.org/atompub/tombstones/1.0\"/>\n    <at:deleted-entry ref=\"https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6802801\" when=\"2022-01-03T00:11:41.837+01:00\" xmlns:at=\"http://purl.org/atompub/tombstones/1.0\"/>\n    <at:deleted-entry ref=\"https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8231582\" when=\"2022-01-03T00:11:41.790+01:00\" xmlns:at=\"http://purl.org/atompub/tombstones/1.0\"/>\n    <at:deleted-entry ref=\"https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968385\" when=\"2022-01-03T00:11:41.750+01:00\" xmlns:at=\"http://purl.org/atompub/tombstones/1.0\"/>\n    <at:deleted-entry ref=\"https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1969766\" when=\"2022-01-03T00:11:41.698+01:00\" xmlns:at=\"http://purl.org/atompub/tombstones/1.0\"/>\n    <at:deleted-entry ref=\"https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968427\" when=\"2022-01-03T00:11:41.653+01:00\" xmlns:at=\"http://purl.org/atompub/tombstones/1.0\"/>\n\n\nRoot element of the XML tree\n\nroot = etree.parse(xml_file).getroot()"
  },
  {
    "objectID": "xml.html#convenience-functions",
    "href": "xml.html#convenience-functions",
    "title": "xml",
    "section": "Convenience functions",
    "text": "Convenience functions\nA function to extract the namespaces declared in an XML file\n\nsource\n\nget_namespaces\n\n get_namespaces (input_file:str|pathlib.Path, root_name:str='base')\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ninput_file\nstr | pathlib.Path\n\nXML file\n\n\nroot_name\nstr\nbase\nName of the root element\n\n\nReturns\ndict\n\nMapping from tag to namespace\n\n\n\n\nget_namespaces(xml_file)\n\n{'cbc-place-ext': 'urn:dgpe:names:draft:codice-place-ext:schema:xsd:CommonBasicComponents-2',\n 'cac-place-ext': 'urn:dgpe:names:draft:codice-place-ext:schema:xsd:CommonAggregateComponents-2',\n 'cbc': 'urn:dgpe:names:draft:codice:schema:xsd:CommonBasicComponents-2',\n 'cac': 'urn:dgpe:names:draft:codice:schema:xsd:CommonAggregateComponents-2',\n 'ns1': 'urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2',\n 'base': 'http://www.w3.org/2005/Atom'}\n\n\nIn order to trim off namespaces from a tag: - a regular expression\n\nassert re_tag.match('{blabla}foo').groups() == ('blabla', 'foo')\n\n\nre_tag.match('{some.namespace}id').groups()\n\n('some.namespace', 'id')\n\n\n\na convenience function exploiting the latter\n\n\nsource\n\n\nsplit_namespace_tag\n\n split_namespace_tag (namespace_tag:str)\n\n\nsplit_namespace_tag('{some.namespace}id')\n\n('some.namespace', 'id')\n\n\n\nsplit_namespace_tag(root.tag)\n\n('http://www.w3.org/2005/Atom', 'feed')\n\n\n\nroot.tag\n\n'{http://www.w3.org/2005/Atom}feed'\n\n\n\n\nRegular entries\nA function to get a list of etree.Element with all the entries (allegedly, procurement contracts)\n\nsource\n\n\nget_entries\n\n get_entries (root:<cyfunctionElementat0x7fdc3817d220>)\n\nEntries are extracted using the above function (only the 4 first ones are shown)\n\nentries = get_entries(root)\nassert len(entries) == 117\nentries[:4]\n\n[<Element {http://www.w3.org/2005/Atom}entry>,\n <Element {http://www.w3.org/2005/Atom}entry>,\n <Element {http://www.w3.org/2005/Atom}entry>,\n <Element {http://www.w3.org/2005/Atom}entry>]\n\n\n\nelement = entries[0]\nsplit_namespace_tag(element.tag)\n\n('http://www.w3.org/2005/Atom', 'entry')\n\n\n\nsubelement = element[3]\nsplit_namespace_tag(subelement.tag)\n\n('http://www.w3.org/2005/Atom', 'title')\n\n\n\nsubelement.text\n\n\"L'objecte del contracte és la renovació de totes les llumeneres que formen la il·luminació existent de tots els carrers i vials del casc urbà de la localitat de Sant Ramon i dels nuclis agregats de La Manresana, Portell, Viver i Gospí\"\n\n\n\nelement\n\n<Element {http://www.w3.org/2005/Atom}entry>\n\n\nEverything is stored as a string in an XML file. The approach below is used to handle conversions.\n\nnumeric_field = '8'\nnumeric_field.isnumeric()\nfloat(numeric_field).is_integer()\n\nTrue\n\n\n\n\nDeleted entries\nIt makes sense to treat separately since they information provided for them is completely different.\n\nsource\n\n\nget_deleted_entries\n\n get_deleted_entries (root:<cyfunctionElementat0x7fdc3817d220>)\n\n\ndeleted_entries = get_deleted_entries(root)\ndeleted_entries[:2]\n\n[<Element {http://purl.org/atompub/tombstones/1.0}deleted-entry>,\n <Element {http://purl.org/atompub/tombstones/1.0}deleted-entry>]\n\n\n\ndeleted_element = deleted_entries[0]\nsplit_namespace_tag(deleted_element.tag)\n\n('http://purl.org/atompub/tombstones/1.0', 'deleted-entry')\n\n\nThese are all-attributes elements\n\ndeleted_element.attrib\n\n{'ref': 'https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968384', 'when': '2022-01-03T00:11:41.879+01:00'}\n\n\nA function to process an XML file into a pd.Series\n\nsource\n\n\ndeleted_to_series\n\n deleted_to_series (input_file:str|pathlib.Path)\n\nReads and parses “deleted” entries in an XML file.\nParameters\n\ninput_file: str or Path\nInput file.\n\nReturns\n\nout: pd.Series\nA Pandas Series with XML data.\n\n\ndeleted_series = deleted_to_series(xml_file)\ndeleted_series\n\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968384   2022-01-02 23:11:41.879000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6802801   2022-01-02 23:11:41.837000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8231582   2022-01-02 23:11:41.790000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968385   2022-01-02 23:11:41.750000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1969766   2022-01-02 23:11:41.698000+00:00\n                                                                                                    ...               \nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1958181   2021-12-30 23:13:12.646000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1962159   2021-12-30 23:13:12.596000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1958329   2021-12-30 23:13:12.544000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1955955   2021-12-30 23:13:12.471000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1955775   2021-12-30 23:13:12.414000+00:00\nName: deleted_on, Length: 383, dtype: datetime64[ns, UTC]\n\n\nAre there duplicates?\n\nlen(deleted_series) > len(deleted_series.unique())\n\nFalse\n\n\n\n# offending_xml = directory / 'deleted_offending.atom'\n# offending_xml\n\n\n# offending_deleted_series = deleted_to_series(offending_xml)\n# offending_deleted_series"
  },
  {
    "objectID": "xml.html#parsing",
    "href": "xml.html#parsing",
    "title": "xml",
    "section": "Parsing",
    "text": "Parsing\nA function to handle multi-valued fields\n\nsource\n\nset_or_append\n\n set_or_append (d:dict, key:str, value:str|dict)\n\nA sample dictionary\n\nsample_dict = {}\n\nA value for foo is added\n\nset_or_append(sample_dict, 'foo', 1)\nsample_dict\n\n{'foo': 1}\n\n\nAnother value for the same key is added\n\nset_or_append(sample_dict, 'foo', 2)\nsample_dict\n\n{'foo': [1, 2]}\n\n\nA different key is added\n\nset_or_append(sample_dict, 'blah', 3)\nsample_dict\n\n{'foo': [1, 2], 'blah': 3}\n\n\nA recursive function to parse a node of the XML tree\n\nsource\n\n\nentry_to_dict\n\n entry_to_dict (entry:<cyfunctionElementat0x7fdc3817d220>,\n                recursive:bool=True)\n\n\nelement_series = entry_to_dict(element)\nelement_series\n\n{'id': 'https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8799346',\n 'summary': 'Id licitación: C. 2-2021; Órgano de Contratación: Ajuntament de Sant Ramon; Importe: 135553.26; Estado: ADJUDICADA',\n 'title': \"L'objecte del contracte és la renovació de totes les llumeneres que formen la il·luminació existent de tots els carrers i vials del casc urbà de la localitat de Sant Ramon i dels nuclis agregats de La Manresana, Portell, Viver i Gospí\",\n 'updated': '2022-01-03T01:11:41.826+01:00',\n 'ContractFolderStatus - ContractFolderID': 'C. 2-2021',\n 'ContractFolderStatus - ContractFolderStatusCode': 'ADJ',\n 'ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID': 'https://contractaciopublica.gencat.cat/ecofin_pscp/AppJava/cap.pscp?reqCode=viewDetail&idCap=2763318',\n 'ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name': 'Ajuntament de Sant Ramon',\n 'ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name': 'Entitats municipals de Catalunya',\n 'ContractFolderStatus - ProcurementProject - Name': \"L'objecte del contracte és la renovació de totes les llumeneres que formen la il·luminació existent de tots els carrers i vials del casc urbà de la localitat de Sant Ramon i dels nuclis agregats de La Manresana, Portell, Viver i Gospí\",\n 'ContractFolderStatus - ProcurementProject - TypeCode': 1,\n 'ContractFolderStatus - ProcurementProject - BudgetAmount - EstimatedOverallContractAmount': '135553.26',\n 'ContractFolderStatus - ProcurementProject - BudgetAmount - TaxExclusiveAmount': '135553.26',\n 'ContractFolderStatus - ProcurementProject - RequiredCommodityClassification - ItemClassificationCode': 34928530,\n 'ContractFolderStatus - ProcurementProject - RealizedLocation - CountrySubentityCode': 'ES513',\n 'ContractFolderStatus - ProcurementProject - PlannedPeriod - DurationMeasure': 3,\n 'ContractFolderStatus - TenderResult - ResultCode': 8,\n 'ContractFolderStatus - TenderResult - ReceivedTenderQuantity': 11,\n 'ContractFolderStatus - TenderResult - WinningParty - PartyIdentification - ID': 'A28526275',\n 'ContractFolderStatus - TenderResult - WinningParty - PartyName - Name': 'AERONAVAL DE CONSTRUCCIONES I INSTALACIONES , SA ( ACISA)',\n 'ContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount': '90078.51',\n 'ContractFolderStatus - TenderingProcess - ProcedureCode': 9,\n 'ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndDate': '2021-12-17',\n 'ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndTime': '14:00:00',\n 'ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode': ['DOC_CN',\n  'DOC_CAN_ADJ'],\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName': ['Perfil del contratante',\n  'Perfil del contratante'],\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate': ['2021-11-30',\n  '2022-01-03']}\n\n\nAn example of multi-valued field\n\nelement_series[sproc.structure.assemble_name(\n    ['ContractFolderStatus', 'ValidNoticeInfo', 'AdditionalPublicationStatus', 'AdditionalPublicationDocumentReference', 'IssueDate']\n)]\n\n['2021-11-30', '2022-01-03']"
  },
  {
    "objectID": "xml.html#data-structures",
    "href": "xml.html#data-structures",
    "title": "xml",
    "section": "Data structures",
    "text": "Data structures\n\nSeries\nA function that just wraps the result of entry_to_dict into a pd.Series\n\nsource\n\n\nentry_to_series\n\n entry_to_series (entry:<cyfunctionElementat0x7fdc3817d220>)\n\nOnly the first 8 fields are printed (enough to show nested elements)\n\nelement_series = entry_to_series(element)\nelement_series[:8]\n\nid                                                                           https://contrataciondelestado.es/sindicacion/P...\nsummary                                                                      Id licitación: C. 2-2021; Órgano de Contrataci...\ntitle                                                                        L'objecte del contracte és la renovació de tot...\nupdated                                                                                          2022-01-03T01:11:41.826+01:00\nContractFolderStatus - ContractFolderID                                                                              C. 2-2021\nContractFolderStatus - ContractFolderStatusCode                                                                            ADJ\nContractFolderStatus - LocatedContractingParty - BuyerProfileURIID           https://contractaciopublica.gencat.cat/ecofin_...\nContractFolderStatus - LocatedContractingParty - Party - PartyName - Name                             Ajuntament de Sant Ramon\ndtype: object\n\n\n\n\nDataFrame\nWe can concatenate together the pd.Series for the different entries into a pd.DataFrame\n\ndf = pd.concat([entry_to_series(e) for e in entries[:4]], axis=1).T\ndf\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - TenderResult - WinningParty - PartyName - Name\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount\n      ContractFolderStatus - TenderingProcess - ProcedureCode\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndDate\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndTime\n      ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate\n      ContractFolderStatus - LegalDocumentReference - ID\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      AERONAVAL DE CONSTRUCCIONES I INSTALACIONES , ...\n      90078.51\n      9\n      2021-12-17\n      14:00:00\n      [DOC_CN, DOC_CAN_ADJ]\n      [Perfil del contratante, Perfil del contratante]\n      [2021-11-30, 2022-01-03]\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      1\n      2022-01-22\n      23:30:00\n      DOC_CN\n      Perfil del contratante\n      2022-01-03\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      1\n      NaN\n      NaN\n      DOC_CN\n      [DOUE, Perfil del contratante]\n      [2021-12-01, 2022-01-03]\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      NaN\n      NaN\n      9\n      2022-01-02\n      23:59:00\n      DOC_CN\n      Perfil del contratante\n      2021-12-13\n      Plec Clausules.pdf\n      https://contractaciopublica.gencat.cat/ecofin_...\n    \n  \n\n4 rows × 29 columns\n\n\n\nThe types of the columns (every type is object since there are missing values everywhere)\n\ndf.dtypes\n\nid                                                                                                                           object\nsummary                                                                                                                      object\ntitle                                                                                                                        object\nupdated                                                                                                                      object\nContractFolderStatus - ContractFolderID                                                                                      object\nContractFolderStatus - ContractFolderStatusCode                                                                              object\nContractFolderStatus - LocatedContractingParty - BuyerProfileURIID                                                           object\nContractFolderStatus - LocatedContractingParty - Party - PartyName - Name                                                    object\nContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name                                       object\nContractFolderStatus - ProcurementProject - Name                                                                             object\nContractFolderStatus - ProcurementProject - TypeCode                                                                         object\nContractFolderStatus - ProcurementProject - BudgetAmount - EstimatedOverallContractAmount                                    object\nContractFolderStatus - ProcurementProject - BudgetAmount - TaxExclusiveAmount                                                object\nContractFolderStatus - ProcurementProject - RequiredCommodityClassification - ItemClassificationCode                         object\nContractFolderStatus - ProcurementProject - RealizedLocation - CountrySubentityCode                                          object\nContractFolderStatus - ProcurementProject - PlannedPeriod - DurationMeasure                                                  object\nContractFolderStatus - TenderResult - ResultCode                                                                             object\nContractFolderStatus - TenderResult - ReceivedTenderQuantity                                                                 object\nContractFolderStatus - TenderResult - WinningParty - PartyIdentification - ID                                                object\nContractFolderStatus - TenderResult - WinningParty - PartyName - Name                                                        object\nContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount                       object\nContractFolderStatus - TenderingProcess - ProcedureCode                                                                      object\nContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndDate                                           object\nContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndTime                                           object\nContractFolderStatus - ValidNoticeInfo - NoticeTypeCode                                                                      object\nContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName                                  object\nContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate    object\nContractFolderStatus - LegalDocumentReference - ID                                                                           object\nContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI                                         object\ndtype: object\n\n\nThe function below follows the above strategy to turn an XML file into a Pandas pd.DataFrame\n\nsource\n\n\nto_df\n\n to_df (input_file:str|pathlib.Path)\n\nReads and parses an XML file into a pd.DataFrame.\nParameters\n\ninput_file: str or Path\nInput file.\n\nReturns\n\nout: pd.DataFrame\nA Pandas DataFrame with XML data.\n\n\ndf = to_df(xml_file)\ndf\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n    \n    \n      112\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1005_391-2021; Órgano de Contra...\n      Apoyo a la gestión del patrimonio filmográfico...\n      2021-12-31T01:00:14.946+01:00\n      1005_391-2021\n      PUB\n      NaN\n      Dirección General de Cultura-Institución Prínc...\n      Departamento de Cultura, Deporte y Juventud\n      Apoyo a la gestión del patrimonio filmográfico...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      113\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8165_3/2021; Órgano de Contrata...\n      Asistencia técnica para la prestación del serv...\n      2021-12-31T01:00:14.393+01:00\n      8165_3/2021\n      EV\n      NaN\n      Mancomunidad de Servicios Sociales de Base de ...\n      MANCOMUNIDAD DE SERVICIOS DE HUARTE Y DE ESTER...\n      Asistencia técnica para la prestación del serv...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      114\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_3/2021; Órgano de Contrata...\n      Contrato de servicios de desinfección, desinse...\n      2021-12-31T01:00:13.594+01:00\n      8113_3/2021\n      EV\n      NaN\n      Subdirector de Gestión y Recursos\n      Agencia Navarra para la Dependencia\n      Contrato de servicios de desinfección, desinse...\n      ...\n      NaN\n      NaN\n      NaN\n      2022-01-01\n      2022-12-31\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      115\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_01 2021; Órgano de Contrat...\n      Contrato del Servicio de Teleasistencia para l...\n      2021-12-31T01:00:12.604+01:00\n      8113_01 2021\n      EV\n      NaN\n      Agencia Navarra de Autonomía y Desarrollo de l...\n      Agencia Navarra para la Dependencia\n      Contrato del Servicio de Teleasistencia para l...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      116\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 0001264/2021; Órgano de contrat...\n      2021/pa-44-4 servicio de mantenimiento integra...\n      2021-12-31T00:14:15.739+01:00\n      0001264/2021\n      RES\n      NaN\n      Agencia Pública Empresarial Sanitaria Bajo Gua...\n      Junta de Andalucía\n      2021/pa-44-4 servicio de mantenimiento integra...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n117 rows × 38 columns\n\n\n\nA convenience function combining to_df and post_process\n\nsource\n\n\nto_curated_df\n\n to_curated_df (input_file:str|pathlib.Path)\n\nReads, parses and tidies up an XML file into a pd.DataFrame.\nParameters\n\ninput_file: str or Path\nInput file.\n\nReturns\n\nout: pd.DataFrame\nA Pandas DataFrame with XML data.\n\n\ntidy_df = to_curated_df(xml_file)\ntidy_df.head()\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03 00:11:41.826000+00:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2021-12-17 14:00:00+00:00\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03 00:00:11.194000+00:00\n      8128_3/2021\n      PUB\n      <NA>\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-22 23:30:00+00:00\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03 00:00:10.399000+00:00\n      1000_0005-CP01-2021-000063\n      EV\n      <NA>\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-02 23:11:40.740000+00:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-02 23:59:00+00:00\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-02 23:11:40.696000+00:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-02 23:59:00+00:00\n    \n  \n\n5 rows × 39 columns\n\n\n\nSome (post-)processing took place\n\ntidy_df.dtypes[:5]\n\nid                                                      string\nsummary                                                 string\ntitle                                                   string\nupdated                                    datetime64[ns, UTC]\nContractFolderStatus - ContractFolderID                 string\ndtype: object"
  },
  {
    "objectID": "xml.html#assorted",
    "href": "xml.html#assorted",
    "title": "xml",
    "section": "Assorted",
    "text": "Assorted\nA function to find the depth (inside the XML) of every column. Columns associated with leafs (0 depth) are not reported.\n\nsource\n\ncolumns_depth\n\n columns_depth (df:pandas.core.frame.DataFrame)\n\n\ntidy_df_columns_depth = columns_depth(tidy_df)\ntidy_df_columns_depth.head()\n\ncolumn\n4    1\n5    1\n6    2\n7    4\n8    4\nName: 0, dtype: int64"
  },
  {
    "objectID": "xml.html#robustness",
    "href": "xml.html#robustness",
    "title": "xml",
    "section": "Robustness",
    "text": "Robustness\nA (sample) file in that directory\n\nxml_file_single = directory / 'PlataformasAgregadasSinMenores_20220104_030016_1_single.atom'\nassert xml_file_single.exists()\nxml_file_single\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PlataformasAgregadasSinMenores_20220104_030016_1_single.atom')\n\n\n\nto_df(xml_file_single)\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - TenderResult - ReceivedTenderQuantity\n      ContractFolderStatus - TenderResult - WinningParty - PartyIdentification - ID\n      ContractFolderStatus - TenderResult - WinningParty - PartyName - Name\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount\n      ContractFolderStatus - TenderingProcess - ProcedureCode\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndDate\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndTime\n      ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      11\n      [A28526275, A28526275 II]\n      [AERONAVAL DE CONSTRUCCIONES I INSTALACIONES ,...\n      90078.51\n      9\n      2021-12-17\n      14:00:00\n      [DOC_CN, DOC_CAN_ADJ]\n      [Perfil del contratante, Perfil del contratante]\n      [2021-11-30, 2022-01-03]\n    \n  \n\n1 rows × 27 columns\n\n\n\n\ntree = etree.parse(xml_file_single)\nroot = tree.getroot()\nentries = get_entries(root)\nentries\n\n\nentry_to_dict(entries[0])"
  },
  {
    "objectID": "extend.html",
    "href": "extend.html",
    "title": "extend",
    "section": "",
    "text": "These imports are not actually needed by the final exported code"
  },
  {
    "objectID": "extend.html#historical-data",
    "href": "extend.html#historical-data",
    "title": "extend",
    "section": "Historical data",
    "text": "Historical data\nDirectory from which to read historical data\n\nhistory_directory = pathlib.Path.cwd().parent / 'samples'\n# history_directory = pathlib.Path.cwd() / 'reports'\nassert history_directory.exists()\nprint(history_directory)\n\n/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples\n\n\nInput directory for the pd.DataFrame to be updated\n\nhistory_input_file = history_directory / '2018-2021_20samples.parquet'\n# history_input_file = history_directory / '2018-2021.parquet'\nassert history_input_file.exists()\nprint(history_input_file)\n\n/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/2018-2021_20samples.parquet\n\n\nThe specific file is\n\nhistory_df = pd.read_parquet(history_input_file)\nhistory_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      Name\n      TypeCode\n      ...\n      ID\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      \n      \n      ...\n      \n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      \n      \n      ...\n      \n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137_1.atom\n      453\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n    \n    \n      452\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n    \n  \n\n2 rows × 41 columns\n\n\n\n\n# history_df = pd.concat({'some.zip': history_df}, names=['zip'])\n# history_df.to_parquet(history_input_file)"
  },
  {
    "objectID": "extend.html#new-data",
    "href": "extend.html#new-data",
    "title": "extend",
    "section": "New data",
    "text": "New data\nThe directory for the zip file whose data is to appended to the already existing pd.DataFrame\n\nzip_directory = history_directory\n# zip_directory = pathlib.Path.cwd() / 'data' / 'agregados'\nassert zip_directory.exists()\nprint(zip_directory)\n\n/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples\n\n\nThe particular file\n\nzip_file = zip_directory / 'PlataformasAgregadasSinMenores_202201_05-06.zip'\nassert zip_file.exists()\nprint(zip_file)\n\n/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PlataformasAgregadasSinMenores_202201_05-06.zip\n\n\nThe file is read and processed in the usual way to get a pd.DataFrame\n\nnew_df = sproc.bundle.read_zip(zip_file, concatenate=True)\n\nMultindexed columns are built\n\nnew_df = sproc.hier.flat_df_to_multiindexed_df(new_df)\n\nNumber of levels in the columns\n\nnew_df.columns.nlevels\n\n6\n\n\nInformation about deleted entries\n\ndeleted_series = sproc.bundle.read_deleted_zip(zip_file)"
  },
  {
    "objectID": "extend.html#merge",
    "href": "extend.html#merge",
    "title": "extend",
    "section": "Merge",
    "text": "Merge\nOld and new data are stacked together\n\nconcatenated_df = sproc.assemble.stack(history_df, new_df)\nconcatenated_df\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n      LocatedContractingParty\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      Name\n      TypeCode\n      ...\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      BuyerProfileURIID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      \n      \n      ...\n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      \n      \n      ...\n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137_1.atom\n      453\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      452\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      451\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1281/17, Entidad: Diputación Provi...\n      Refuerzo de firme en la VP 4013 Melgar de Arri...\n      2018-01-02 08:02:51.744000+00:00\n      1281/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de firme en la VP 4013 Melgar de Arri...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      450\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: VI/17/04-015; Órgano de Contrat...\n      Obras de edificación en el barrio de Pumarabul...\n      2018-01-02 08:02:56.115000+00:00\n      VI/17/04-015\n      EV\n      <NA>\n      Consejería de Servicios y Derechos Sociales\n      Edificación de 36 VPP, garaje y trasteros en e...\n      3.0\n      ...\n      http://www.asturias.es/Proveedores/FICHEROS/ES...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-12-11 14:00:00+00:00\n      NaT\n      <NA>\n    \n    \n      449\n      https://contrataciondelestado.es/sindicacion/P...\n      Id Licitación: PcPG/2017/194222, Órgano de Con...\n      Suministro de gas natural canalizado y gas nat...\n      2018-01-02 09:10:49.572000+00:00\n      PcPG/2017/194222\n      ADJ\n      A12017369\n      Consellería de Economía, Emprego e Industria\n      Suministro de gas natural canalizado y gas nat...\n      1.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-09-29 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n    \n    \n      PlataformasAgregadasSinMenores_202201_05-06.zip\n      PlataformasAgregadasSinMenores_20220106_030013.atom\n      471\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021/57-12334; Órgano de Contra...\n      L'objecte d'aquest contracte és la prestació c...\n      2022-01-04 12:12:09.949000+00:00\n      2021/57-12334\n      PUB\n      <NA>\n      Ajuntament de Palau-solità i Plegamans\n      L'objecte d'aquest contracte és la prestació c...\n      1.0\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      PPT_subministrament 8 cameres videovigilancia_...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2022-01-19 15:00:00+00:00\n      NaT\n      https://contractaciopublica.gencat.cat/ecofin_...\n    \n    \n      472\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 32/2021; Órgano de Contratación...\n      Licitació per procediment obert harmonitzat i ...\n      2022-01-04 12:12:09.742000+00:00\n      32/2021\n      RES\n      <NA>\n      Consell Comarcal del Baix Llobregat\n      Licitació per procediment obert harmonitzat i ...\n      2.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-05-07 15:00:00+00:00\n      NaT\n      https://contractaciopublica.gencat.cat/ecofin_...\n    \n    \n      473\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1977/2021; Órgano de Contrataci...\n      L'objecte d'aquest contracte és la prestació d...\n      2022-01-04 12:12:09.666000+00:00\n      1977/2021\n      RES\n      <NA>\n      Ajuntament de Sant Adrià de Besòs\n      L'objecte d'aquest contracte és la prestació d...\n      2.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-06-30 23:59:00+00:00\n      NaT\n      https://contractaciopublica.gencat.cat/ecofin_...\n    \n    \n      474\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: EXI-2022-7; Órgano de Contratac...\n      Servei de trasllat de béns mobles( mobiliari, ...\n      2022-01-04 12:12:09.602000+00:00\n      EXI-2022-7\n      ADJ\n      <NA>\n      Departament d'Acció Exterior i Govern Obert\n      Servei de trasllat de béns mobles( mobiliari, ...\n      2.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-12-13 13:00:00+00:00\n      NaT\n      https://contractaciopublica.gencat.cat/ecofin_...\n    \n    \n      475\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: CONTR/2021/000000137; Órgano de...\n      Servei de redacció del Projecte Executiu d'obr...\n      2022-01-04 12:12:09.536000+00:00\n      CONTR/2021/000000137\n      ADJ\n      <NA>\n      Institut d'Assistència Sanitària (IAS)\n      Servei de redacció del Projecte Executiu d'obr...\n      2.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2021-11-10 18:00:00+00:00\n      NaT\n      https://contractaciopublica.gencat.cat/ecofin_...\n    \n  \n\n971 rows × 42 columns\n\n\n\nOnly the last update is kept\n\nconcatenated_df = sproc.postprocess.keep_updates_only(concatenated_df)\nconcatenated_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n      LocatedContractingParty\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      Name\n      TypeCode\n      ...\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      BuyerProfileURIID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      \n      \n      ...\n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      \n      \n      ...\n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137_1.atom\n      453\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      452\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n  \n\n2 rows × 42 columns\n\n\n\nIn order to make it easy to update the deleted_on column in the existing pd.DataFrame using the data contained in the deleted pd.Series (i.e., to get automatic alignment) we - reindex the DataFrame using id\n\nreindexed_concatenated_df = concatenated_df.reset_index().set_index(['id'])\nreindexed_concatenated_df.head(2)\n\n\n\n\n\n  \n    \n      \n      zip\n      file name\n      entry\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n      LocatedContractingParty\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      ...\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      BuyerProfileURIID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      ...\n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      ...\n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n      \n    \n    \n      id\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1992428\n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137...\n      453\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1992427\n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137...\n      452\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n  \n\n2 rows × 44 columns\n\n\n\n\ndrop the first level of the series (which leaves only id)\n\n\n# reindexed_deleted_series = deleted_series.droplevel(0)\nreindexed_deleted_series = deleted_series.droplevel([0, 1])\nreindexed_deleted_series.head(2)\n\nid\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6724977   2022-01-04 00:12:01.376000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968315   2022-01-03 23:11:57.567000+00:00\nName: deleted_on, dtype: datetime64[ns, UTC]\n\n\nDuplicates are removed from the above pd.Series\n\ndeduplicated_reindexed_deleted_series = sproc.postprocess.deduplicate_deleted_series(reindexed_deleted_series)\ndeduplicated_reindexed_deleted_series\n\nid\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1957921   2022-01-03 23:11:56.535000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1959074   2022-01-03 23:11:56.497000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968266   2022-01-04 23:12:11.916000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968267   2022-01-04 23:12:12.775000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968268   2022-01-04 23:12:12.731000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968269   2022-01-04 23:12:13.013000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968271   2022-01-04 23:12:12.172000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968272   2022-01-04 23:12:12.957000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968279   2022-01-04 23:12:12.039000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968280   2022-01-04 23:12:12.865000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968282   2022-01-04 23:12:13.107000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968284   2022-01-04 23:12:12.911000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968285   2022-01-04 23:12:12.819000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968286   2022-01-04 23:12:13.147000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968287   2022-01-04 23:12:11.998000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968288   2022-01-04 23:12:11.957000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968289   2022-01-04 23:12:12.129000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968290   2022-01-04 23:12:12.635000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968291   2022-01-04 23:12:13.191000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968294   2022-01-04 23:12:13.328000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968299   2022-01-04 23:12:13.236000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968301   2022-01-04 23:12:13.283000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968302   2022-01-04 23:12:12.680000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968303   2022-01-04 23:12:13.058000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968305   2022-01-04 23:12:12.076000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968315   2022-01-03 23:11:57.567000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968317   2022-01-03 23:11:56.751000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968318   2022-01-03 23:11:57.038000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968319   2022-01-03 23:11:56.620000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968321   2022-01-03 23:11:57.323000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968324   2022-01-03 23:11:57.471000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968325   2022-01-03 23:11:56.579000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968327   2022-01-03 23:11:57.089000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968329   2022-01-03 23:11:56.850000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968331   2022-01-03 23:11:56.897000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968332   2022-01-03 23:11:56.949000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968333   2022-01-03 23:11:57.183000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968335   2022-01-03 23:11:57.275000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968337   2022-01-03 23:11:57.375000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968338   2022-01-03 23:11:56.805000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968343   2022-01-03 23:11:57.232000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968344   2022-01-03 23:11:57.426000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968345   2022-01-03 23:11:57.516000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968346   2022-01-03 23:11:56.661000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968358   2022-01-03 23:11:56.706000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968360   2022-01-03 23:11:57.141000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1968361   2022-01-03 23:11:56.991000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/6724977   2022-01-04 00:12:01.376000+00:00\nhttps://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8892704   2022-01-04 13:13:12.670000+00:00\nName: deleted_on, dtype: datetime64[ns, UTC]\n\n\nThe old and new sizes\n\nreindexed_deleted_series.shape, deduplicated_reindexed_deleted_series.shape\n\n((49,), (49,))\n\n\nNo keys are lost along the way\n\nassert (set(reindexed_deleted_series.index) - set(deduplicated_reindexed_deleted_series.index)) == set()\n\nDuplicates in the old pd.Series\n\nreindexed_deleted_series.loc[reindexed_deleted_series.index.duplicated()]\n\nSeries([], Name: deleted_on, dtype: datetime64[ns, UTC])\n\n\nThere should be none in the new\n\nassert deduplicated_reindexed_deleted_series.loc[deduplicated_reindexed_deleted_series.index.duplicated()].empty\n\nWhat is the intersection between the entries in the new pd.DataFrame and the pd.Series with information about deletes (only the first elements).\n\nlist(itertools.islice(set(reindexed_concatenated_df.index) & set(deduplicated_reindexed_deleted_series.index), 0, 4))\n\n[]\n\n\nA deleted entry, identified by its id, and also showing the source ATOM file\n\ndeleted_entry = deduplicated_reindexed_deleted_series.index[0]\ndeleted_entry\n\n'https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1957921'\n\n\nIt’s not actually present in the data\n\n(new_df['id'] == deleted_entry).sum()\n\n0\n\n\nIn order to see if something changes when updating column deleted_on, a backup of the old pd.DataFrame is made\n\n# reindexed_concatenated_df = bak_reindexed_concatenated_df.copy()\nbak_reindexed_concatenated_df = reindexed_concatenated_df.copy()\n\nThe columns deleted_on in the pd.DataFrame is updated for the indexes present in the deleted series. Notice that we cannot do\nreindexed_concatenated_df['deleted_on'] = deduplicated_reindexed_deleted_series\nbecause that would effectively wipe out the values of all the entries not present in the series.\nna’s in the existing pd.DataFrame are filled in with data from the deleted series\n\nreindexed_concatenated_df['deleted_on'] = reindexed_concatenated_df['deleted_on'].fillna(deduplicated_reindexed_deleted_series)\n\nThe number of non-NAs in the old and new pd.DataFrames\n\nn_notnas_old, n_notnas_new = bak_reindexed_concatenated_df['deleted_on'].notna().sum(), reindexed_concatenated_df['deleted_on'].notna().sum()\nn_notnas_old, n_notnas_new\n\n(0, 0)\n\n\nThe latter be larger than or equal than the former\n\nassert n_notnas_new >= n_notnas_old\n\nThe original index is reset (notice the reset_index() in the middle that avoids losing id columns, which is right now the index)\n\nreindexed_concatenated_df = reindexed_concatenated_df.reset_index().set_index(['zip', 'file name', 'entry'])\n\nFinally\n\nreindexed_concatenated_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n      LocatedContractingParty\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      Name\n      TypeCode\n      ...\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      BuyerProfileURIID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      \n      \n      ...\n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      \n      \n      ...\n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137_1.atom\n      453\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      452\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n  \n\n2 rows × 42 columns\n\n\n\nA function encompassing all of the above steps in one go\n\nsource\n\ndf_with_zip\n\n df_with_zip (history_df:pandas.core.frame.DataFrame,\n              zip_file:str|pathlib.Path,\n              output_file:str|pathlib.Path|None=None)\n\nExtend an existing DataFrame with the data in a zip file\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nhistory_df\nDataFrame\n\nDataFrame to be extended\n\n\nzip_file\nstr | pathlib.Path\n\nZip file with new data\n\n\noutput_file\nstr | pathlib.Path | None\nNone\nOutput file (optional)\n\n\nReturns\nNone | pandas.core.frame.DataFrame\n\nExtended DataFrame or nothing if an output_file was passed\n\n\n\nFor historical reasons, a slightly higher-level function is included\n\nsource\n\n\nparquet_with_zip\n\n parquet_with_zip (history_file:str|pathlib.Path,\n                   zip_file:str|pathlib.Path,\n                   output_file:str|pathlib.Path|None=None)\n\nExtend an existing parquet file with the data in a zip file\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nhistory_file\nstr | pathlib.Path\n\nDataFrame to be extended\n\n\nzip_file\nstr | pathlib.Path\n\nZip file with new data\n\n\noutput_file\nstr | pathlib.Path | None\nNone\nOutput file (optional)\n\n\nReturns\nNone | pandas.core.frame.DataFrame\n\nExtended DataFrame or nothing if an output_file was passed\n\n\n\n\nmerged_df = parquet_with_zip(history_input_file, zip_file)\nmerged_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n      LocatedContractingParty\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      Name\n      TypeCode\n      ...\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      BuyerProfileURIID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      \n      \n      ...\n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      \n      \n      ...\n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137_1.atom\n      453\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n    \n      452\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n      <NA>\n    \n  \n\n2 rows × 42 columns\n\n\n\nWe should be getting exactly the same result as above\n\nassert reindexed_concatenated_df.equals(merged_df)\n\n\noutput_file = history_directory / 'merged.parquet'\nparquet_with_zip(history_input_file, zip_file, output_file)\n\n\nsample_output_df = pd.read_parquet(output_file)\nsample_output_df.head(2)\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n      LocatedContractingParty\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      Name\n      TypeCode\n      ...\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n      BuyerProfileURIID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      \n      \n      ...\n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      \n      \n      ...\n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137_1.atom\n      453\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      None\n      <NA>\n    \n    \n      452\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      None\n      <NA>\n    \n  \n\n2 rows × 42 columns\n\n\n\nLet us make sure nothing was lost\n\nassert sample_output_df.shape == merged_df.shape"
  },
  {
    "objectID": "download.html",
    "href": "download.html",
    "title": "download",
    "section": "",
    "text": "The base URLs and file names for every kind of file hosted (the final / at the end of each base_url is required for urllib.parse.urljoin below to work correctly).\n\noutsiders_info = {'base_url': 'https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/', 'base_filename': 'PlataformasAgregadasSinMenores_'}\ninsiders_info = {'base_url': 'https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_643/', 'base_filename': 'licitacionesPerfilesContratanteCompleto3_'}\nminors_info = {'base_url': 'https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1143/', 'base_filename': 'contratosMenoresPerfilesContratantes_'}\n\nA function to download a file from internet.\n\nsource\n\nfile\n\n file (url:str, output_file:str|pathlib.Path, timeout:float=2.0)\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nurl\nstr\n\nURL for the file to be downloaded\n\n\noutput_file\nstr | pathlib.Path\n\nName of the local file to be saved\n\n\ntimeout\nfloat\n2.0\nHow long to wait for a response\n\n\nReturns\nNone\n\n\n\n\n\nA sample file (from this repository) is downloaded\n\nurl = 'https://raw.githubusercontent.com/manuvazquez/sproc/main/samples/2018-2021_20samples.parquet'\noutput_file = 'download_sample.parquet'\nfile(url, output_file)\n\nLet us check it is readable\n\npd.read_parquet(output_file).head()\n\n\n\n\n\n  \n    \n      \n      \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n      deleted_on\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      LocatedContractingParty\n      TenderingProcess\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      Party\n      Name\n      TypeCode\n      ...\n      ID\n      Attachment\n      ID\n      Attachment\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      TenderSubmissionDeadlinePeriod\n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyIdentification\n      PartyName\n      \n      \n      ...\n      \n      ExternalReference\n      \n      ExternalReference\n      ParentLocatedParty\n      EndDate\n      EndTime\n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ID\n      Name\n      \n      \n      ...\n      \n      URI\n      \n      URI\n      ParentLocatedParty\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      PartyName\n      ParentLocatedParty\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      Name\n      PartyName\n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n      \n    \n    \n      zip\n      file name\n      entry\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      some.zip\n      PlataformasAgregadasSinMenores_20180217_180137_1.atom\n      453\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1284/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      2018-01-02 08:01:52.024000+00:00\n      1284/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 3001 Renedo de Esgu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n    \n    \n      452\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1282/17, Entidad: Diputación Provi...\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      2018-01-02 08:02:24.833000+00:00\n      1282/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de Firme en la VP 6603 Mota del Marqu...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n    \n    \n      451\n      https://contrataciondelestado.es/sindicacion/P...\n      Expediente: 1281/17, Entidad: Diputación Provi...\n      Refuerzo de firme en la VP 4013 Melgar de Arri...\n      2018-01-02 08:02:51.744000+00:00\n      1281/17\n      RES\n      L02000047\n      Diputación Provincial de Valladolid\n      Refuerzo de firme en la VP 4013 Melgar de Arri...\n      3.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-11-02\n      23:59:00\n      2017-11-02 23:59:00+00:00\n      NaT\n    \n    \n      450\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: VI/17/04-015; Órgano de Contrat...\n      Obras de edificación en el barrio de Pumarabul...\n      2018-01-02 08:02:56.115000+00:00\n      VI/17/04-015\n      EV\n      <NA>\n      Consejería de Servicios y Derechos Sociales\n      Edificación de 36 VPP, garaje y trasteros en e...\n      3.0\n      ...\n      Pliego_Clausulas_Administrativas_VI-17-04-015.pdf\n      http://www.asturias.es/Proveedores/FICHEROS/ES...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-12-11 14:00:00+00:00\n      NaT\n    \n    \n      449\n      https://contrataciondelestado.es/sindicacion/P...\n      Id Licitación: PcPG/2017/194222, Órgano de Con...\n      Suministro de gas natural canalizado y gas nat...\n      2018-01-02 09:10:49.572000+00:00\n      PcPG/2017/194222\n      ADJ\n      A12017369\n      Consellería de Economía, Emprego e Industria\n      Suministro de gas natural canalizado y gas nat...\n      1.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      2017-09-29 23:59:00+00:00\n      NaT\n    \n  \n\n5 rows × 41 columns\n\n\n\n\naggregate_2018 = 'https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2018.zip'\n# file(aggregate_2018, 'foo.zip')\n\nULRs are produced from the given date, from_date, onwards.\n\nsource\n\n\nmake_urls\n\n make_urls (base_url:str, base_filename:str, from_date:datetime.datetime)\n\nAssemble URLs for files of a given kind that are to be downloaded\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\nbase_url\nstr\nURL to the server including the hosting directory\n\n\nbase_filename\nstr\nFile name without neither date information nor extension\n\n\nfrom_date\ndatetime\nThe starting date\n\n\nReturns\nlist\nList of tuples (URL, file name)\n\n\n\nAs an example, let us assemble the URLs of all the outsiders files from November 2019 on.\n\nurls_filenames = make_urls(**sproc.structure.tables['outsiders'], from_date=datetime.datetime(2019, 11, 1))\n# urls_filenames[:3]\nurls_filenames\n\n[('https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_201912.zip',\n  'PlataformasAgregadasSinMenores_201912.zip'),\n ('https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2020.zip',\n  'PlataformasAgregadasSinMenores_2020.zip'),\n ('https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2021.zip',\n  'PlataformasAgregadasSinMenores_2021.zip'),\n ('https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2022.zip',\n  'PlataformasAgregadasSinMenores_2022.zip')]\n\n\nFrom the 2022 new year’s eve\n\nmake_urls(**sproc.structure.tables['outsiders'], from_date=datetime.datetime(2022, 1, 1) - datetime.timedelta(days=1))\n\n[('https://contrataciondelsectorpublico.gob.es/sindicacion/sindicacion_1044/PlataformasAgregadasSinMenores_2022.zip',\n  'PlataformasAgregadasSinMenores_2022.zip')]\n\n\nIn order to actually download all the files of a given kind from a certain `date.\n\nsource\n\n\nfrom_date\n\n from_date (kind:str, date:datetime.datetime,\n            output_directory:str|pathlib.Path=Path('/home/runner/work/spro\n            c/sproc'))\n\nDownloads all the files of a given kind from a certain moment in time\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nkind\nstr\n\nOne of ‘outsiders’, ‘insiders’, or ‘minors’\n\n\ndate\ndatetime\n\nThe starting date\n\n\noutput_directory\nstr | pathlib.Path\n/home/runner/work/sproc/sproc\nOutput directory, defaults is the current one\n\n\nReturns\nlist\n\nFile name of every downloaded file\n\n\n\nLet us make a new directory…\n\noutput_directory = pathlib.Path.cwd().parent / 'downloads'\noutput_directory.mkdir(exist_ok=True)\nprint(output_directory)\n\n/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/downloads\n\n\n…into which files are to be downloaded\n\ndl_files = from_date('outsiders', datetime.datetime(2021, 10, 1), output_directory=output_directory)\n\nDownloading raw data: 100%|██████████| 3/3 [00:00<00:00, 334.23it/s]\n\n\n\"PlataformasAgregadasSinMenores_202111.zip\" already exists\n\"PlataformasAgregadasSinMenores_202112.zip\" already exists\n\"PlataformasAgregadasSinMenores_2022.zip\" already exists"
  },
  {
    "objectID": "io.html",
    "href": "io.html",
    "title": "io",
    "section": "",
    "text": "Directory where the data (XML files) are stored\nA (sample) file in that directory\nBelow, it is required that no extension is provided for the file\nA class to handle reading and writing a pd.DataFrame\nsource"
  },
  {
    "objectID": "io.html#saving",
    "href": "io.html#saving",
    "title": "io",
    "section": "Saving",
    "text": "Saving\n\nDealing with multivalued columns\nA shorter version of the pd.DataFrame\n\nhead_df = df.head(5).copy()\nhead_df\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n5 rows × 38 columns\n\n\n\nThere are multivalued columns in the pd.DataFrame\n\nmultivalued_columns = sproc.structure.multivalued_columns(head_df)\nmultivalued_columns\n\n['ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode',\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName',\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate']\n\n\n\nhead_df[multivalued_columns]\n\n\n\n\n\n  \n    \n      \n      ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate\n    \n  \n  \n    \n      0\n      [DOC_CN, DOC_CAN_ADJ]\n      [Perfil del contratante, Perfil del contratante]\n      [2021-11-30, 2022-01-03]\n    \n    \n      1\n      DOC_CN\n      Perfil del contratante\n      2022-01-03\n    \n    \n      2\n      DOC_CN\n      [DOUE, Perfil del contratante]\n      [2021-12-01, 2022-01-03]\n    \n    \n      3\n      DOC_CN\n      Perfil del contratante\n      2021-12-13\n    \n    \n      4\n      DOC_CN\n      Perfil del contratante\n      2021-12-17\n    \n  \n\n\n\n\nA convenience function to turn something into a list if not already one.\n\n_cast_to_list_if_not_already(2)\n\n[2]\n\n\n\n_cast_to_list_if_not_already([2])\n\n[2]\n\n\n\n_cast_to_list_if_not_already(np.array([2]))\n\narray([2])\n\n\nA function to homegenize multivalued columns so that every element is a list (maybe containing a single element).\n\nsource\n\n\nhomogenize_multivalued\n\n homogenize_multivalued (df:pandas.core.frame.DataFrame)\n\n\nhomogenized_head_df = homogenize_multivalued(head_df)\nhomogenized_head_df\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n5 rows × 38 columns\n\n\n\nNotice the affected columns are still multivalued\n\nassert sproc.structure.multivalued_columns(homogenized_head_df) == multivalued_columns\n\n\n# head_df.to_parquet(file.name.with_suffix('.parquet'))\n\nA function to try and cast all the elements in a list to float falling back to str when any single element fails\n\nsource\n\n\ncast_list_to_floats_or_strs\n\n cast_list_to_floats_or_strs (l:list)\n\nConversion to floats is fine\n\ncast_list_to_floats_or_strs([np.NAN, '14.1'])\n\n[nan, 14.1]\n\n\nConversion to float is not possible due to the newly added last element\n\ncast_list_to_floats_or_strs([np.NAN, '14.1', 'hola'])\n\n['nan', '14.1', 'hola']\n\n\nPandas’ NA are a special case\n\ncast_list_to_floats_or_strs([1.0, 2., pd.NA])\n\n[1.0, 2.0, nan]\n\n\nWhen nested lists are found, every element (either scalar or list) is converted to str\n\nconverted = cast_list_to_floats_or_strs([3.14, [1, 2]])\nconverted\n\n['3.14', '[1, 2]']\n\n\n\nconverted[1]\n\n'[1, 2]'\n\n\nFor the sake of example, a fake float value is added to the first element, which until now consisted only of strs.\n\nhomogenized_head_df.loc[0, 'ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode'].append(13.5)\n\nOn the other hand, the second element is turned into float-only list.\n\nhomogenized_head_df.loc[1, 'ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode'] = [3.14]\nhomogenized_head_df['ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode']\n\n0    [DOC_CN, DOC_CAN_ADJ, 13.5]\n1                         [3.14]\n2                       [DOC_CN]\n3                       [DOC_CN]\n4                       [DOC_CN]\nName: ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode, dtype: object\n\n\nAll the individual lists (a row in this column or pd.Series) are homogenized (all the values cast to the either float or str)\n\ncast_homogenized_head_df = homogenized_head_df[multivalued_columns].applymap(cast_list_to_floats_or_strs)\ncast_homogenized_head_df\n\n\n\n\n\n  \n    \n      \n      ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate\n    \n  \n  \n    \n      0\n      [DOC_CN, DOC_CAN_ADJ, 13.5]\n      [Perfil del contratante, Perfil del contratante]\n      [2021-11-30, 2022-01-03]\n    \n    \n      1\n      [3.14]\n      [Perfil del contratante]\n      [2022-01-03]\n    \n    \n      2\n      [DOC_CN]\n      [DOUE, Perfil del contratante]\n      [2021-12-01, 2022-01-03]\n    \n    \n      3\n      [DOC_CN]\n      [Perfil del contratante]\n      [2021-12-13]\n    \n    \n      4\n      [DOC_CN]\n      [Perfil del contratante]\n      [2021-12-17]\n    \n  \n\n\n\n\nHowever, the types across lists are not necessary the same\n\ncast_homogenized_head_df['ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode'].apply(lambda x: type(x[0]))\n\n0      <class 'str'>\n1    <class 'float'>\n2      <class 'str'>\n3      <class 'str'>\n4      <class 'str'>\nName: ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode, dtype: object\n\n\nA function to cast all the lists to a common type.\n\nsource\n\n\ncast_multivalued_series_to_common_type\n\n cast_multivalued_series_to_common_type (s:pandas.core.series.Series)\n\n\ncommon_type_homogenized_head_df = cast_multivalued_series_to_common_type(homogenized_head_df['ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode'])\ncommon_type_homogenized_head_df\n\n0    [DOC_CN, DOC_CAN_ADJ, 13.5]\n1                         [3.14]\n2                       [DOC_CN]\n3                       [DOC_CN]\n4                       [DOC_CN]\nName: ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode, dtype: object\n\n\n\ncommon_type_homogenized_head_df.apply(lambda x: type(x[0]))\n\n0    <class 'str'>\n1    <class 'str'>\n2    <class 'str'>\n3    <class 'str'>\n4    <class 'str'>\nName: ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode, dtype: object\n\n\n\n\nWriting\nA method to write a pd.DataFrame to disk\n\nsource\n\n\nshow_doc\n\n show_doc (sym, renderer=None, name:str|None=None, title_level:int=3)\n\nShow signature and docstring for sym\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nsym\n\n\nSymbol to document\n\n\nrenderer\nNoneType\nNone\nOptional renderer (defaults to markdown)\n\n\nname\nstr | None\nNone\nOptionally override displayed name of sym\n\n\ntitle_level\nint\n3\nHeading level to use for symbol name\n\n\n\nFile is written\n\nfile.write(df)\n\nDoes it exist?\n\nfile.exists()\n\nTrue"
  },
  {
    "objectID": "io.html#loading",
    "href": "io.html#loading",
    "title": "io",
    "section": "Loading",
    "text": "Loading\n\nsource\n\nshow_doc\n\n show_doc (sym, renderer=None, name:str|None=None, title_level:int=3)\n\nShow signature and docstring for sym\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nsym\n\n\nSymbol to document\n\n\nrenderer\nNoneType\nNone\nOptional renderer (defaults to markdown)\n\n\nname\nstr | None\nNone\nOptionally override displayed name of sym\n\n\ntitle_level\nint\n3\nHeading level to use for symbol name\n\n\n\n\nloaded_df = file.read()\nloaded_df.head()\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n5 rows × 38 columns\n\n\n\nSaved and loaded pd.DataFrames should be equal\n\nassert df.equals(loaded_df)\n\n\nfile.name.unlink()"
  },
  {
    "objectID": "structure.html",
    "href": "structure.html",
    "title": "structure",
    "section": "",
    "text": "For testing purposes\nSome hardware metadata: the base URLs and file names for every kind of file hosted (the final / at the end of each base_url is required for urllib.parse.urljoin below to work correctly)."
  },
  {
    "objectID": "structure.html#sample-data",
    "href": "structure.html#sample-data",
    "title": "structure",
    "section": "Sample data",
    "text": "Sample data\nDirectory where the data (XML files) are stored\n\ndirectory = pathlib.Path.cwd().parent / 'samples'\nassert directory.exists()\ndirectory\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples')\n\n\nA (sample) file in that directory\n\nxml_file = directory / 'PlataformasAgregadasSinMenores_20220104_030016_1.atom'\nassert xml_file.exists()\nxml_file\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PlataformasAgregadasSinMenores_20220104_030016_1.atom')\n\n\n\ndf = sproc.xml.to_df(xml_file)\ndf\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n    \n    \n      112\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1005_391-2021; Órgano de Contra...\n      Apoyo a la gestión del patrimonio filmográfico...\n      2021-12-31T01:00:14.946+01:00\n      1005_391-2021\n      PUB\n      NaN\n      Dirección General de Cultura-Institución Prínc...\n      Departamento de Cultura, Deporte y Juventud\n      Apoyo a la gestión del patrimonio filmográfico...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      113\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8165_3/2021; Órgano de Contrata...\n      Asistencia técnica para la prestación del serv...\n      2021-12-31T01:00:14.393+01:00\n      8165_3/2021\n      EV\n      NaN\n      Mancomunidad de Servicios Sociales de Base de ...\n      MANCOMUNIDAD DE SERVICIOS DE HUARTE Y DE ESTER...\n      Asistencia técnica para la prestación del serv...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      114\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_3/2021; Órgano de Contrata...\n      Contrato de servicios de desinfección, desinse...\n      2021-12-31T01:00:13.594+01:00\n      8113_3/2021\n      EV\n      NaN\n      Subdirector de Gestión y Recursos\n      Agencia Navarra para la Dependencia\n      Contrato de servicios de desinfección, desinse...\n      ...\n      NaN\n      NaN\n      NaN\n      2022-01-01\n      2022-12-31\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      115\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_01 2021; Órgano de Contrat...\n      Contrato del Servicio de Teleasistencia para l...\n      2021-12-31T01:00:12.604+01:00\n      8113_01 2021\n      EV\n      NaN\n      Agencia Navarra de Autonomía y Desarrollo de l...\n      Agencia Navarra para la Dependencia\n      Contrato del Servicio de Teleasistencia para l...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      116\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 0001264/2021; Órgano de contrat...\n      2021/pa-44-4 servicio de mantenimiento integra...\n      2021-12-31T00:14:15.739+01:00\n      0001264/2021\n      RES\n      NaN\n      Agencia Pública Empresarial Sanitaria Bajo Gua...\n      Junta de Andalucía\n      2021/pa-44-4 servicio de mantenimiento integra...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n117 rows × 38 columns"
  },
  {
    "objectID": "structure.html#nested-tags",
    "href": "structure.html#nested-tags",
    "title": "structure",
    "section": "Nested tags",
    "text": "Nested tags\nWhen a tag is nested inside other tag the string below is used to assemble the name of the resulting column from those of the original tags\nFor instance, a tag <month> inside a tag <date> will yield a column\n\nf'month{nested_tags_separator}date'\n\n'month - date'\n\n\nA high-level function to do exactly that\n\nsource\n\nassemble_name\n\n assemble_name (tags:list)\n\nAssemble the name of field/column in the DataFrame from a path of nested tags\n\n\n\n\nType\nDetails\n\n\n\n\ntags\nlist\nTags\n\n\nReturns\nstr\nName\n\n\n\n\nassemble_name(['foo', 'fa'])\n\n'foo - fa'\n\n\nNaNs are ignored…\n\nassemble_name(['foo', np.nan])\n\n'foo'\n\n\n…and so are empty strings\n\nassemble_name(['foo', np.nan, ''])\n\n'foo'\n\n\nMutivalued data\nlists of values are possible. A function to check whether a pd.Series (a column in a pd.DataFrame) has lists.\n\nsource\n\n\nis_multivalued\n\n is_multivalued (s:pandas.core.series.Series)\n\nReturns True is the given pd.Series has a list at any index\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\ns\nSeries\nInput\n\n\nReturns\nbool\nTrue if the input contains some list\n\n\n\n\nmultivalued_column = assemble_name(['ContractFolderStatus', 'ValidNoticeInfo', 'NoticeTypeCode'])\nis_multivalued(df[multivalued_column])\n\nTrue\n\n\n\ndf[multivalued_column].head()\n\n0    [DOC_CN, DOC_CAN_ADJ]\n1                   DOC_CN\n2                   DOC_CN\n3                   DOC_CN\n4                   DOC_CN\nName: ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode, dtype: object\n\n\n\nis_multivalued(df['id'])\n\nFalse\n\n\nA function exploiting the above function to return (only) the columns that are multivalued.\n\nsource\n\n\nmultivalued_columns\n\n multivalued_columns (df:pandas.core.frame.DataFrame)\n\nReturns the list of multi-valued columns\n\n\n\n\nType\nDetails\n\n\n\n\ndf\nDataFrame\nInput\n\n\nReturns\nlist\nColumns’ names\n\n\n\n\nmultivalued_columns(df)\n\n['ContractFolderStatus - ProcurementProject - RequiredCommodityClassification - ItemClassificationCode',\n 'ContractFolderStatus - TenderResult - ResultCode',\n 'ContractFolderStatus - TenderResult - ReceivedTenderQuantity',\n 'ContractFolderStatus - TenderResult - WinningParty - PartyIdentification - ID',\n 'ContractFolderStatus - TenderResult - WinningParty - PartyName - Name',\n 'ContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount',\n 'ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode',\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName',\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate',\n 'ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID']"
  },
  {
    "objectID": "postprocess.html",
    "href": "postprocess.html",
    "title": "postprocess",
    "section": "",
    "text": "In order to avoid circular dependencies in the resulting Python modules, and since this is only for testing"
  },
  {
    "objectID": "postprocess.html#sample-data",
    "href": "postprocess.html#sample-data",
    "title": "postprocess",
    "section": "Sample data",
    "text": "Sample data\nDirectory where the data (XML files) are stored\n\ndirectory = pathlib.Path.cwd().parent / 'samples'\nassert directory.exists()\ndirectory\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples')\n\n\nA (sample) file in that directory\n\nxml_file = directory / 'PlataformasAgregadasSinMenores_20220104_030016_1.atom'\nassert xml_file.exists()\nxml_file\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PlataformasAgregadasSinMenores_20220104_030016_1.atom')\n\n\n\ndf = sproc.xml.to_df(xml_file)\ndf\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n    \n    \n      112\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1005_391-2021; Órgano de Contra...\n      Apoyo a la gestión del patrimonio filmográfico...\n      2021-12-31T01:00:14.946+01:00\n      1005_391-2021\n      PUB\n      NaN\n      Dirección General de Cultura-Institución Prínc...\n      Departamento de Cultura, Deporte y Juventud\n      Apoyo a la gestión del patrimonio filmográfico...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      113\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8165_3/2021; Órgano de Contrata...\n      Asistencia técnica para la prestación del serv...\n      2021-12-31T01:00:14.393+01:00\n      8165_3/2021\n      EV\n      NaN\n      Mancomunidad de Servicios Sociales de Base de ...\n      MANCOMUNIDAD DE SERVICIOS DE HUARTE Y DE ESTER...\n      Asistencia técnica para la prestación del serv...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      114\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_3/2021; Órgano de Contrata...\n      Contrato de servicios de desinfección, desinse...\n      2021-12-31T01:00:13.594+01:00\n      8113_3/2021\n      EV\n      NaN\n      Subdirector de Gestión y Recursos\n      Agencia Navarra para la Dependencia\n      Contrato de servicios de desinfección, desinse...\n      ...\n      NaN\n      NaN\n      NaN\n      2022-01-01\n      2022-12-31\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      115\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_01 2021; Órgano de Contrat...\n      Contrato del Servicio de Teleasistencia para l...\n      2021-12-31T01:00:12.604+01:00\n      8113_01 2021\n      EV\n      NaN\n      Agencia Navarra de Autonomía y Desarrollo de l...\n      Agencia Navarra para la Dependencia\n      Contrato del Servicio de Teleasistencia para l...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      116\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 0001264/2021; Órgano de contrat...\n      2021/pa-44-4 servicio de mantenimiento integra...\n      2021-12-31T00:14:15.739+01:00\n      0001264/2021\n      RES\n      NaN\n      Agencia Pública Empresarial Sanitaria Bajo Gua...\n      Junta de Andalucía\n      2021/pa-44-4 servicio de mantenimiento integra...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n117 rows × 38 columns\n\n\n\nThere are some multivalued columns\n\nsproc.structure.multivalued_columns(df)\n\n['ContractFolderStatus - ProcurementProject - RequiredCommodityClassification - ItemClassificationCode',\n 'ContractFolderStatus - TenderResult - ResultCode',\n 'ContractFolderStatus - TenderResult - ReceivedTenderQuantity',\n 'ContractFolderStatus - TenderResult - WinningParty - PartyIdentification - ID',\n 'ContractFolderStatus - TenderResult - WinningParty - PartyName - Name',\n 'ContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount',\n 'ContractFolderStatus - ValidNoticeInfo - NoticeTypeCode',\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName',\n 'ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate',\n 'ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID']"
  },
  {
    "objectID": "postprocess.html#columns-types",
    "href": "postprocess.html#columns-types",
    "title": "postprocess",
    "section": "Columns’ types",
    "text": "Columns’ types\nA regular expression matching any column whose final component is PostalZone\nFor instance\n\nre_postal_zone.match('foo - PostalZone')\n\n<re.Match object; span=(0, 16), match='foo - PostalZone'>\n\n\nbut\n\nre_postal_zone.match('Address - Number')\n\nTwo positives\n\nassert re_postal_zone.match(sproc.structure.assemble_name(['ContractFolderStatus', 'ProcurementProject', 'RealizedLocation', 'Address', 'PostalZone']))\nassert re_postal_zone.match(sproc.structure.assemble_name(['ContractFolderStatus', 'LocatedContractingParty', 'Party', 'PostalAddress', 'PostalZone']))\n\nA negative\n\nassert not re_postal_zone.match(sproc.structure.assemble_name(['ContractFolderStatus', 'Wap']))\n\nThe list below specifies fields that are to be interpreted as str\n\nstr_columns[:2]\n\n[]\n\n\nFor easier processing, the lists are turned into str\n\nassembled_str_columns\n\n[]\n\n\nThese columns, if present,\n\ndeadline_date_col = sproc.structure.assemble_name(['ContractFolderStatus', 'TenderingProcess','TenderSubmissionDeadlinePeriod','EndDate'])\ndeadline_time_col = sproc.structure.assemble_name(['ContractFolderStatus', 'TenderingProcess','TenderSubmissionDeadlinePeriod','EndTime'])\n\nare parsed jointly into a new column\n\ndeadline_datetime_col = sproc.structure.assemble_name(['ContractFolderStatus', 'TenderingProcess', 'TenderSubmissionDeadlinePeriod'])\n\nA function to tidy up some things in the pd.DataFrames returned by sproc.xml.to_df\n\nsource\n\ntypecast_columns\n\n typecast_columns (input_df:pandas.core.frame.DataFrame)\n\nTidy up the pd.DataFrame returned by to_df.\nParameters\n\ninput_df: pd.DataFrame\nInput DataFrame as ready by to_df.\n\nReturns\n\nout: pd.DataFrame\nPost-processed DataFrame.\n\n\npost_df = typecast_columns(df)\npost_df.head()\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03 00:11:41.826000+00:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2021-12-17 14:00:00+00:00\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03 00:00:11.194000+00:00\n      8128_3/2021\n      PUB\n      <NA>\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-22 23:30:00+00:00\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03 00:00:10.399000+00:00\n      1000_0005-CP01-2021-000063\n      EV\n      <NA>\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-02 23:11:40.740000+00:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-02 23:59:00+00:00\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-02 23:11:40.696000+00:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-02 23:59:00+00:00\n    \n  \n\n5 rows × 39 columns\n\n\n\nAfter post-processing some objects have been parsed as dates.\n\npost_df.dtypes[:5]\n\nid                                                      string\nsummary                                                 string\ntitle                                                   string\nupdated                                    datetime64[ns, UTC]\nContractFolderStatus - ContractFolderID                 string\ndtype: object\n\n\nMultivalued columns are still multivalued\n\nassert sproc.structure.multivalued_columns(post_df) == sproc.structure.multivalued_columns(df)"
  },
  {
    "objectID": "postprocess.html#most-recent-update",
    "href": "postprocess.html#most-recent-update",
    "title": "postprocess",
    "section": "Most recent update",
    "text": "Most recent update\nupdated, after post-processing is apt for ordering\n\npost_df['updated'].dtype\n\ndatetime64[ns, UTC]\n\n\nWe order the entries by updated date (ascending order) and then group by id\n\ngrouped = post_df.sort_values('updated').groupby('id')\n\nWe are interested in groups with more than one element\n\nnot_one_element_group = (grouped.size() > 1)\nnot_one_element_group\n\nid\nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\n                                                     ...  \nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\nhttps://contrataciondelestado.es/sindicacion/P...    False\nLength: 115, dtype: bool\n\n\nNumber of tenders with updates\n\nnot_one_element_group.sum()\n\n2\n\n\n\nactual_groups = not_one_element_group.index[not_one_element_group]\nactual_groups\n\nIndex(['https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8904280', 'https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8994209'], dtype='string', name='id')\n\n\nThere is a group with this number of elements\n\ngrouped.size().max()\n\n2\n\n\nFor getting groups with exactly a certain number of elements (here \\(2\\) again)\n\nsize_2_groups = (grouped.size() == 2).loc[lambda x: x].index\nsize_2_groups\n\nIndex(['https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8904280', 'https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8994209'], dtype='string', name='id')\n\n\n\nfirst_group = grouped.get_group(actual_groups[0])\nfirst_group\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod\n    \n  \n  \n    \n      32\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 3069_1/2021; Órgano de Contrata...\n      Construcción de depósito regulador de 100m3 en...\n      2022-01-01 00:00:16.761000+00:00\n      3069_1/2021\n      EV\n      <NA>\n      CONCEJO DE GALBARRA\n      Concejo de Galbarra\n      Construcción de depósito regulador de 100m3 en...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      19\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 3069_1/2021; Órgano de Contrata...\n      Construcción de depósito regulador de 100m3 en...\n      2022-01-01 07:30:09.698000+00:00\n      3069_1/2021\n      EV\n      <NA>\n      CONCEJO DE GALBARRA\n      Concejo de Galbarra\n      Construcción de depósito regulador de 100m3 en...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n  \n\n2 rows × 39 columns\n\n\n\nTrue if columns are different across elements\n\ncolumns_are_different = first_group.iloc[0] != first_group.iloc[-1]\ncolumns_are_different\n\nid                                                                                                                           False\nsummary                                                                                                                      False\ntitle                                                                                                                        False\nupdated                                                                                                                       True\nContractFolderStatus - ContractFolderID                                                                                      False\nContractFolderStatus - ContractFolderStatusCode                                                                              False\nContractFolderStatus - LocatedContractingParty - BuyerProfileURIID                                                            True\nContractFolderStatus - LocatedContractingParty - Party - PartyName - Name                                                    False\nContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name                                       False\nContractFolderStatus - ProcurementProject - Name                                                                             False\nContractFolderStatus - ProcurementProject - TypeCode                                                                         False\nContractFolderStatus - ProcurementProject - BudgetAmount - EstimatedOverallContractAmount                                    False\nContractFolderStatus - ProcurementProject - BudgetAmount - TaxExclusiveAmount                                                False\nContractFolderStatus - ProcurementProject - RequiredCommodityClassification - ItemClassificationCode                         False\nContractFolderStatus - ProcurementProject - RealizedLocation - CountrySubentityCode                                          False\nContractFolderStatus - ProcurementProject - PlannedPeriod - DurationMeasure                                                  False\nContractFolderStatus - TenderResult - ResultCode                                                                              True\nContractFolderStatus - TenderResult - ReceivedTenderQuantity                                                                  True\nContractFolderStatus - TenderResult - WinningParty - PartyIdentification - ID                                                 True\nContractFolderStatus - TenderResult - WinningParty - PartyName - Name                                                         True\nContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount                        True\nContractFolderStatus - TenderingProcess - ProcedureCode                                                                      False\nContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndDate                                            True\nContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndTime                                            True\nContractFolderStatus - ValidNoticeInfo - NoticeTypeCode                                                                      False\nContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - PublicationMediaName                                  False\nContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate     True\nContractFolderStatus - LegalDocumentReference - ID                                                                            True\nContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI                                          True\nContractFolderStatus - TechnicalDocumentReference - ID                                                                        True\nContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI                                      True\nContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate                                                         True\nContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate                                                           True\nContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID                                             True\nContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name                   True\nContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate                                       True\nContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime                                       True\nContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID                                        True\nContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod                                                      True\ndtype: bool\n\n\nThe values in those columns are (besides updated) all nans\n\nfirst_group[first_group.columns[columns_are_different]]\n\n\n\n\n\n  \n    \n      \n      updated\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - TenderResult - ResultCode\n      ContractFolderStatus - TenderResult - ReceivedTenderQuantity\n      ContractFolderStatus - TenderResult - WinningParty - PartyIdentification - ID\n      ContractFolderStatus - TenderResult - WinningParty - PartyName - Name\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - LegalMonetaryTotal - TaxExclusiveAmount\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndDate\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod - EndTime\n      ContractFolderStatus - ValidNoticeInfo - AdditionalPublicationStatus - AdditionalPublicationDocumentReference - IssueDate\n      ...\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod\n    \n  \n  \n    \n      32\n      2022-01-01 00:00:16.761000+00:00\n      <NA>\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      <NA>\n      <NA>\n      [2021-12-16, 2021-12-16, 2021-12-16, 2021-12-1...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      19\n      2022-01-01 07:30:09.698000+00:00\n      <NA>\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      <NA>\n      <NA>\n      [2021-12-16, 2021-12-16, 2021-12-16, 2021-12-1...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n  \n\n2 rows × 22 columns\n\n\n\nOnly the last element of each group (the most recent entry) is kept\n\nonly_last_update_df = grouped.last()\nonly_last_update_df.head()\n\n\n\n\n\n  \n    \n      \n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ContractFolderStatus - ProcurementProject - TypeCode\n      ...\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod\n    \n    \n      id\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 6011900114;Órgano de Contrataci...\n      Servicio de migración de los productos BMC ins...\n      2021-12-31 10:56:15.855000+00:00\n      6011900114\n      RES\n      http://www.madrid.org/cs/Satellite?cid=1204201...\n      Empresa Pública de Metro de Madrid, S.A.\n      Consejería de Transportes e Infraestructuras\n      Servicio de migración de los productos BMC ins...\n      2.0\n      ...\n      1354764548025.pdf\n      http://www.madrid.org/contratos-publicos/13547...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      None\n      NaT\n    \n    \n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 11/2019; Órgano de Contratació...\n      Concurso de proyectos para la rehabilitación u...\n      2021-12-31 10:41:20.201000+00:00\n      11/2019\n      EV\n      <NA>\n      Alcaldia\n      Ayuntamiento de Leioa\n      Concurso de proyectos para la rehabilitación u...\n      2.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      Ayuntamiento de Leioa\n      <NA>\n      <NA>\n      None\n      2020-01-23 17:00:00+00:00\n    \n    \n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 6012000208;Órgano de Contrataci...\n      Suministro de equipos de manutención (carretil...\n      2021-12-31 11:11:15.851000+00:00\n      6012000208\n      RES\n      http://www.madrid.org/cs/Satellite?cid=1204201...\n      Empresa Pública de Metro de Madrid, S.A.\n      Consejería de Transportes e Infraestructuras\n      Suministro de equipos de manutención (carretil...\n      1.0\n      ...\n      1354836373815.pdf\n      http://www.madrid.org/contratos-publicos/13548...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      None\n      NaT\n    \n    \n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 6012100119;Órgano de Contrataci...\n      Servicio de soporte al mantenimiento de instal...\n      2021-12-31 10:11:16.027000+00:00\n      6012100119\n      RES\n      http://www.madrid.org/cs/Satellite?cid=1204201...\n      Empresa Pública de Metro de Madrid, S.A.\n      Consejería de Transportes e Infraestructuras\n      Servicio de soporte al mantenimiento de instal...\n      2.0\n      ...\n      1354874714036.pdf\n      http://www.madrid.org/contratos-publicos/13548...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      None\n      NaT\n    \n    \n      https://contrataciondelestado.es/sindicacion/P...\n      Id Licitación: PcPG/2021/801758, Órgano de Con...\n      Servicio para la caracterización hidromorfolóx...\n      2022-01-02 22:11:15.096000+00:00\n      PcPG/2021/801758\n      RES\n      https://www.contratosdegalicia.gal//consultaOr...\n      Ente Público Empresarial Augas de Galicia\n      <NA>\n      Servicio para la caracterización hidromorfolóx...\n      2.0\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      A12024974\n      <NA>\n      <NA>\n      <NA>\n      None\n      2021-06-03 14:00:00+00:00\n    \n  \n\n5 rows × 38 columns\n\n\n\nA function which keeps, for every procurement entry, only the last update.\n\nsource\n\nkeep_updates_only\n\n keep_updates_only (df:pandas.core.frame.DataFrame)\n\n\nlen(post_df)\n\n117\n\n\n\nonly_updated_df = keep_updates_only(post_df)\nonly_updated_df.head()\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n      ContractFolderStatus - TenderingProcess - TenderSubmissionDeadlinePeriod\n    \n  \n  \n    \n      116\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 0001264/2021; Órgano de contrat...\n      2021/pa-44-4 servicio de mantenimiento integra...\n      2021-12-30 23:14:15.739000+00:00\n      0001264/2021\n      RES\n      <NA>\n      Agencia Pública Empresarial Sanitaria Bajo Gua...\n      Junta de Andalucía\n      2021/pa-44-4 servicio de mantenimiento integra...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2021-11-11 15:00:00+00:00\n    \n    \n      115\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_01 2021; Órgano de Contrat...\n      Contrato del Servicio de Teleasistencia para l...\n      2021-12-31 00:00:12.604000+00:00\n      8113_01 2021\n      EV\n      <NA>\n      Agencia Navarra de Autonomía y Desarrollo de l...\n      Agencia Navarra para la Dependencia\n      Contrato del Servicio de Teleasistencia para l...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      114\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8113_3/2021; Órgano de Contrata...\n      Contrato de servicios de desinfección, desinse...\n      2021-12-31 00:00:13.594000+00:00\n      8113_3/2021\n      EV\n      <NA>\n      Subdirector de Gestión y Recursos\n      Agencia Navarra para la Dependencia\n      Contrato de servicios de desinfección, desinse...\n      ...\n      <NA>\n      <NA>\n      2022-01-01\n      2022-12-31\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      113\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8165_3/2021; Órgano de Contrata...\n      Asistencia técnica para la prestación del serv...\n      2021-12-31 00:00:14.393000+00:00\n      8165_3/2021\n      EV\n      <NA>\n      Mancomunidad de Servicios Sociales de Base de ...\n      MANCOMUNIDAD DE SERVICIOS DE HUARTE Y DE ESTER...\n      Asistencia técnica para la prestación del serv...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      NaT\n    \n    \n      112\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1005_391-2021; Órgano de Contra...\n      Apoyo a la gestión del patrimonio filmográfico...\n      2021-12-31 00:00:14.946000+00:00\n      1005_391-2021\n      PUB\n      <NA>\n      Dirección General de Cultura-Institución Prínc...\n      Departamento de Cultura, Deporte y Juventud\n      Apoyo a la gestión del patrimonio filmográfico...\n      ...\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      <NA>\n      NaN\n      2022-01-14 23:59:00+00:00\n    \n  \n\n5 rows × 39 columns\n\n\n\n\nlen(only_updated_df)\n\n115"
  },
  {
    "objectID": "postprocess.html#deleted-series",
    "href": "postprocess.html#deleted-series",
    "title": "postprocess",
    "section": "Deleted series",
    "text": "Deleted series\n\nimport sproc.bundle\n\n\nzip_file = directory / 'yearly' / 'PlataformasAgregadasSinMenores_2018.zip'\nassert zip_file.exists()\nzip_file\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/yearly/PlataformasAgregadasSinMenores_2018.zip')\n\n\n\ndeleted_series = sproc.bundle.read_deleted_zip(zip_file)\ndeleted_series.head(2)\n\nzip                                      file name                                              id                                                                                 \nPlataformasAgregadasSinMenores_2018.zip  PlataformasAgregadasSinMenores_20180217_180137_1.atom  https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1985903   2018-01-04 13:11:18.021000+00:00\n                                                                                                https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1969197   2018-01-04 13:11:17.921000+00:00\nName: deleted_on, dtype: datetime64[ns, UTC]\n\n\nNo duplicates\n\ndeleted_series.index.get_level_values(1).duplicated().any()\n\nTrue\n\n\nWe add an artificial one\n\nnew_data = pd.Timestamp(year=2017, month=1, day=3, tz=deleted_series[-1].tz)\ndeleted_series.loc['foo', deleted_series.index[-1][1], deleted_series.index[-1][2]] = new_data\n\nNow have a duplicate (at level 1, i.e., id)\n\ndeleted_series.index.get_level_values(2).duplicated().any()\n\nTrue\n\n\nA function to get rid of duplicates from a deleted series. The oldest entry is kept.\n\nsource\n\ndeduplicate_deleted_series\n\n deduplicate_deleted_series (series:pandas.core.series.Series)\n\n\ndeduplicated_series = deduplicate_deleted_series(deleted_series)\ndeduplicated_series.tail(2)\n\nzip                                      file name                                              id                                                                                 \nPlataformasAgregadasSinMenores_2018.zip  PlataformasAgregadasSinMenores_20180217_190110_1.atom  https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/1996094   2018-02-07 09:01:16.378000+00:00\nfoo                                      PlataformasAgregadasSinMenores_20180217_190110_1.atom  https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/2000163          2017-01-03 00:00:00+00:00\nName: deleted_on, dtype: datetime64[ns, UTC]\n\n\n\nassert not deduplicated_series.index.get_level_values(2).duplicated().any()\n\n\ndeleted_series.shape, deduplicated_series.shape\n\n((52,), (51,))"
  },
  {
    "objectID": "core.html",
    "href": "core.html",
    "title": "core",
    "section": "",
    "text": "Directory where the zip files are stored"
  },
  {
    "objectID": "core.html#processing-a-single-zip-file",
    "href": "core.html#processing-a-single-zip-file",
    "title": "core",
    "section": "Processing a single zip file",
    "text": "Processing a single zip file\n\nsource\n\ncli_process_zip\n\n cli_process_zip (args:list=None)\n\n\nzip_file = directory /'yearly' / 'PlataformasAgregadasSinMenores_2018.zip'\nassert zip_file.exists()\nprint(f'{zip_file=}')\n\n\noutput_file = directory / 'year_2018.parquet'\nprint(f'{output_file=}')\n\n\nargs = [zip_file.as_posix(), output_file.as_posix()]\ncli_process_zip(args)\n\n\npd.read_parquet(output_file).head(2)"
  },
  {
    "objectID": "core.html#extending-historical-data",
    "href": "core.html#extending-historical-data",
    "title": "core",
    "section": "Extending historical data",
    "text": "Extending historical data\nA function to extend an existing parquet file with new data in a zip file.\n\nsource\n\ncli_extend_parquet_with_zip\n\n cli_extend_parquet_with_zip (args:list=None)\n\nTesting with some sample files\n\nhistory_file = directory /'2018-2021_20samples.parquet'\nassert history_file.exists()\nprint(f'{history_file=}')\n\n\nnew_zip_file = directory / 'PlataformasAgregadasSinMenores_202201_28-29.zip'\nassert new_zip_file.exists()\nprint(f'{new_zip_file=}')\n\n\noutput_file = directory / 'extended_sample.parquet'\noutput_file\n\n\nargs = [history_file.as_posix(), new_zip_file.as_posix(), output_file.as_posix()]\ncli_extend_parquet_with_zip(args)"
  },
  {
    "objectID": "core.html#renaming-columns",
    "href": "core.html#renaming-columns",
    "title": "core",
    "section": "Renaming columns",
    "text": "Renaming columns\n\nsource\n\ncli_rename_columns\n\n cli_rename_columns (args:list=None)\n\n\nrenamed_cols_output_file = directory / 'renamed_cols_extended_sample.parquet'\nrenamed_cols_output_file\n\n\nmapping_file = directory / 'PLACE.yaml'\nassert mapping_file.exists()\nmapping_file\n\n\nargs = [output_file.as_posix(), mapping_file.as_posix(), renamed_cols_output_file.as_posix()]\ncli_rename_columns(args)\n\n\npd.read_parquet(renamed_cols_output_file).head(2)"
  },
  {
    "objectID": "core.html#reading-a-bunch-of-zip-files",
    "href": "core.html#reading-a-bunch-of-zip-files",
    "title": "core",
    "section": "Reading a bunch of zip files",
    "text": "Reading a bunch of zip files\nIt receives a list of zip files and returns a (column-hierarchical) pd.DataFrame encompassing all the data\n\nsource\n\nread_zips\n\n read_zips (files:list[str|pathlib.Path])\n\nBuild a DataFrame out of a bunch of zip files\n\n\n\n\nType\nDetails\n\n\n\n\nfiles\nlist\nInput files\n\n\nReturns\nDataFrame\nProcurement data\n\n\n\nLet us pick a couple of files for testing\n\nzip_files = ['PlataformasAgregadasSinMenores_2018.zip', 'PlataformasAgregadasSinMenores_2019.zip']\nzip_files = [directory/ 'yearly' / e for e in zip_files]\nzip_files\n\n\ndf = read_zips(zip_files)\ndf.head()\n\n\n\nCLI\nA companion function to allow using the above from the command-line.\n\nsource\n\n\ncli_read_zips\n\n cli_read_zips (args:list=None)\n\n\ncli_read_zips([e.as_posix() for e in zip_files] + '-o o.parquet'.split())"
  },
  {
    "objectID": "core.html#updates",
    "href": "core.html#updates",
    "title": "core",
    "section": "Updates",
    "text": "Updates\nCore function to download new data and updated existing local structures.\n\nsource\n\nupdate\n\n update (kind:str, output_directory:str|pathlib.Path)\n\nUpdate local data structures\n\n\n\n\nType\nDetails\n\n\n\n\nkind\nstr\nOne of ‘outsiders’, ‘insiders’, or ‘minors’\n\n\noutput_directory\nstr | pathlib.Path\nThe path where hosting\n\n\n\n\n\nCLI\nA companion function to allow using the above from the command-line.\n\nsource\n\n\ncli_update\n\n cli_update (args:list=None)\n\n\n# output_directory = pathlib.Path.cwd().parent / 'data' / 'plataforma'\n# args = ['outsiders', '-o', output_directory.as_posix()]\n# cli_update(args)"
  },
  {
    "objectID": "bundle.html",
    "href": "bundle.html",
    "title": "bundle",
    "section": "",
    "text": "Some handy imports that are not actually required by the library.\nDirectory where the zip files are stored"
  },
  {
    "objectID": "bundle.html#extra-tests",
    "href": "bundle.html#extra-tests",
    "title": "bundle",
    "section": "Extra tests",
    "text": "Extra tests\n\n# data_file = pathlib.Path.cwd() / 'data' / 'agregados'\n# data_file /= 'PlataformasAgregadasSinMenores_202201.zip'\n# data_file /= 'PlataformasAgregadasSinMenores_202202.zip'\n# data_file /= 'PlataformasAgregadasSinMenores_202203.zip'\n\n\ndata_file = pathlib.Path.cwd() / 'data' / 'perfiles_plataforma'\ndata_file /= 'licitacionesPerfilesContratanteCompleto3_202201.zip'\n\n\ndf = read_zip(data_file, concatenate=True)\ndf.shape\n\n\ndf['ContractFolderStatus - ProcurementProject - BudgetAmount - TotalAmount'].dtype\n\n\ngrouping_col = sproc.structure.assemble_name(['ContractFolderStatus', 'LocatedContractingParty', 'Party', 'PartyName', 'Name'])\ngrouping_col\n\n\namount_col = sproc.structure.assemble_name(['ContractFolderStatus', 'ProcurementProject', 'BudgetAmount', 'TotalAmount'])\namount_col\n\n\ndf.groupby(grouping_col).agg(money=(amount_col, 'sum'), n=(amount_col, 'size'))"
  },
  {
    "objectID": "hierarchical.html",
    "href": "hierarchical.html",
    "title": "hier",
    "section": "",
    "text": "Directory where the data (XML files) are stored\nA (sample) file in that directory\nRoot element of the XML tree\nEntries are extracted\nThe first one is picked out\nIt is turned into a pd.Series"
  },
  {
    "objectID": "hierarchical.html#series",
    "href": "hierarchical.html#series",
    "title": "hier",
    "section": "Series",
    "text": "Series\nWe can easily iterate the series\n\nnext(iter(element_series.items()))\n\n('id',\n 'https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8799346')\n\n\n\nindex_paths = []\nvalues = []\nfor i, v in element_series.items():\n    index_paths.append(tuple(i.split(sproc.structure.nested_tags_separator)))\n    values.append(v)\n\n\nindex_paths[:6]\n\n[('id',),\n ('summary',),\n ('title',),\n ('updated',),\n ('ContractFolderStatus', 'ContractFolderID'),\n ('ContractFolderStatus', 'ContractFolderStatusCode')]\n\n\n\nvalues[:6]\n\n['https://contrataciondelestado.es/sindicacion/PlataformasAgregadasSinMenores/8799346',\n 'Id licitación: C. 2-2021; Órgano de Contratación: Ajuntament de Sant Ramon; Importe: 135553.26; Estado: ADJUDICADA',\n \"L'objecte del contracte és la renovació de totes les llumeneres que formen la il·luminació existent de tots els carrers i vials del casc urbà de la localitat de Sant Ramon i dels nuclis agregats de La Manresana, Portell, Viver i Gospí\",\n '2022-01-03T01:11:41.826+01:00',\n 'C. 2-2021',\n 'ADJ']\n\n\n\nmultiindex = pd.MultiIndex.from_tuples(index_paths)\nmultiindex[:6]\n\nMultiIndex([(                  'id',                        nan, nan, ...),\n            (             'summary',                        nan, nan, ...),\n            (               'title',                        nan, nan, ...),\n            (             'updated',                        nan, nan, ...),\n            ('ContractFolderStatus',         'ContractFolderID', nan, ...),\n            ('ContractFolderStatus', 'ContractFolderStatusCode', nan, ...)],\n           )\n\n\n\nmultiindexed_series = pd.Series(values, index=multiindex)\nmultiindexed_series[:6]\n\nid                    NaN                       NaN  NaN  NaN    https://contrataciondelestado.es/sindicacion/P...\nsummary               NaN                       NaN  NaN  NaN    Id licitación: C. 2-2021; Órgano de Contrataci...\ntitle                 NaN                       NaN  NaN  NaN    L'objecte del contracte és la renovació de tot...\nupdated               NaN                       NaN  NaN  NaN                        2022-01-03T01:11:41.826+01:00\nContractFolderStatus  ContractFolderID          NaN  NaN  NaN                                            C. 2-2021\n                      ContractFolderStatusCode  NaN  NaN  NaN                                                  ADJ\ndtype: object\n\n\nA function that turns the index of a pd.Series into a hierarchical (pd.MultiIndex) one.\n\nsource\n\nflat_series_to_multiindexed_series\n\n flat_series_to_multiindexed_series (s:pandas.core.series.Series)\n\nReturns a multi-indexed version of the input\n\n\n\n\nType\nDetails\n\n\n\n\ns\nSeries\nFlat series\n\n\nReturns\nSeries\nMulti-indexed series\n\n\n\n\nflat_series_to_multiindexed_series(element_series)[:6]\n\nid                    NaN                       NaN  NaN  NaN    https://contrataciondelestado.es/sindicacion/P...\nsummary               NaN                       NaN  NaN  NaN    Id licitación: C. 2-2021; Órgano de Contrataci...\ntitle                 NaN                       NaN  NaN  NaN    L'objecte del contracte és la renovació de tot...\nupdated               NaN                       NaN  NaN  NaN                        2022-01-03T01:11:41.826+01:00\nContractFolderStatus  ContractFolderID          NaN  NaN  NaN                                            C. 2-2021\n                      ContractFolderStatusCode  NaN  NaN  NaN                                                  ADJ\ndtype: object"
  },
  {
    "objectID": "hierarchical.html#dataframe",
    "href": "hierarchical.html#dataframe",
    "title": "hier",
    "section": "DataFrame",
    "text": "DataFrame\nWe can concatenate together the pd.Series for the different entries into a pd.DataFrame\n\npd.concat([flat_series_to_multiindexed_series(sproc.xml.entry_to_series(e)) for e in entries[:4]], axis=1).T\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      NaN\n      NaN\n      NaN\n      NaN\n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      TenderResult\n      TenderingProcess\n      ValidNoticeInfo\n      LegalDocumentReference\n    \n    \n      \n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      WinningParty\n      AwardedTenderedProject\n      ProcedureCode\n      TenderSubmissionDeadlinePeriod\n      NoticeTypeCode\n      AdditionalPublicationStatus\n      ID\n      Attachment\n    \n    \n      \n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      PartyName\n      PartyName\n      NaN\n      ...\n      PartyName\n      LegalMonetaryTotal\n      NaN\n      EndDate\n      EndTime\n      NaN\n      PublicationMediaName\n      AdditionalPublicationDocumentReference\n      NaN\n      ExternalReference\n    \n    \n      \n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      Name\n      Name\n      NaN\n      ...\n      Name\n      TaxExclusiveAmount\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      IssueDate\n      NaN\n      URI\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      AERONAVAL DE CONSTRUCCIONES I INSTALACIONES , ...\n      90078.51\n      9\n      2021-12-17\n      14:00:00\n      [DOC_CN, DOC_CAN_ADJ]\n      [Perfil del contratante, Perfil del contratante]\n      [2021-11-30, 2022-01-03]\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      1\n      2022-01-22\n      23:30:00\n      DOC_CN\n      Perfil del contratante\n      2022-01-03\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      1\n      NaN\n      NaN\n      DOC_CN\n      [DOUE, Perfil del contratante]\n      [2021-12-01, 2022-01-03]\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      NaN\n      NaN\n      9\n      2022-01-02\n      23:59:00\n      DOC_CN\n      Perfil del contratante\n      2021-12-13\n      Plec Clausules.pdf\n      https://contractaciopublica.gencat.cat/ecofin_...\n    \n  \n\n4 rows × 29 columns\n\n\n\nHowever, there is a problem if the pd.Series’s to be concatenated have different number of levels\n\nflat_series_to_multiindexed_series(sproc.xml.entry_to_series(entries[15])).index.nlevels\n\n5\n\n\n\nflat_series_to_multiindexed_series(sproc.xml.entry_to_series(entries[16])).index.nlevels\n\n6\n\n\n\ntry:\n    pd.concat([flat_series_to_multiindexed_series(sproc.xml.entry_to_series(e)) for e in entries[15:17]], axis=1).T\nexcept ValueError:\n    print('Oooooooooops')\n\nOooooooooops\n\n\nThe function below just converts the pd.DataFrame column-wise. Columns with different levels are handled as suggested in this post.\n\nsource\n\nflat_df_to_multiindexed_df\n\n flat_df_to_multiindexed_df (input_df:pandas.core.frame.DataFrame)\n\nReads and parses an XML file into a DataFrame\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\ninput_df\nDataFrame\nInput dataframe\n\n\nReturns\nDataFrame\nA column-hierarchical version of the input dataframe\n\n\n\nWe first build the pd.DataFrame\n\ndf = sproc.xml.to_df(xml_file)\ndf.head(6)\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus - ContractFolderID\n      ContractFolderStatus - ContractFolderStatusCode\n      ContractFolderStatus - LocatedContractingParty - BuyerProfileURIID\n      ContractFolderStatus - LocatedContractingParty - Party - PartyName - Name\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - ProcurementProject - Name\n      ...\n      ContractFolderStatus - LegalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - TechnicalDocumentReference - ID\n      ContractFolderStatus - TechnicalDocumentReference - Attachment - ExternalReference - URI\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - StartDate\n      ContractFolderStatus - ProcurementProject - PlannedPeriod - EndDate\n      ContractFolderStatus - LocatedContractingParty - Party - PartyIdentification - ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndDate\n      ContractFolderStatus - TenderingProcess - ParticipationRequestReceptionPeriod - EndTime\n      ContractFolderStatus - TenderResult - AwardedTenderedProject - ProcurementProjectLotID\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      5\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2809/2021; Órgano de Contrataci...\n      Servei de visites i activitats sobre Història ...\n      2022-01-03T00:11:40.639+01:00\n      2809/2021\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Institut de Cultura de Barcelona\n      Entitats municipals de Catalunya\n      Servei de visites i activitats sobre Història ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      2809-21 PPT.pdf\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n6 rows × 38 columns\n\n\n\n…and, afterwards, a hierarchical version thereof\n\nhierarchical_df = flat_df_to_multiindexed_df(df)\nhierarchical_df.head()\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      ProcurementProject\n      LocatedContractingParty\n      TenderingProcess\n      TenderResult\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      Attachment\n      ID\n      Attachment\n      PlannedPeriod\n      Party\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      AwardedTenderedProject\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      ExternalReference\n      \n      ExternalReference\n      StartDate\n      EndDate\n      PartyIdentification\n      ParentLocatedParty\n      EndDate\n      EndTime\n      ProcurementProjectLotID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      URI\n      \n      URI\n      \n      \n      ID\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1000_0005-CP01-2021-000063; Órg...\n      Contrato del servicio de realización de labore...\n      2022-01-03T01:00:10.399+01:00\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 1379/2020 4738; Órgano de Contr...\n      Obres de renovació de l'enllumenat públic a la...\n      2022-01-03T00:11:40.740+01:00\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 2021-44; Órgano de Contratación...\n      Subministre i la instal·lació fotovoltaica en ...\n      2022-01-03T00:11:40.696+01:00\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n5 rows × 38 columns\n\n\n\nCross-sections of the above pd.DataFrame can be extracted\n\nhierarchical_df.xs('id', axis='columns')\n\n0      https://contrataciondelestado.es/sindicacion/P...\n1      https://contrataciondelestado.es/sindicacion/P...\n2      https://contrataciondelestado.es/sindicacion/P...\n3      https://contrataciondelestado.es/sindicacion/P...\n4      https://contrataciondelestado.es/sindicacion/P...\n                             ...                        \n112    https://contrataciondelestado.es/sindicacion/P...\n113    https://contrataciondelestado.es/sindicacion/P...\n114    https://contrataciondelestado.es/sindicacion/P...\n115    https://contrataciondelestado.es/sindicacion/P...\n116    https://contrataciondelestado.es/sindicacion/P...\nName: id, Length: 117, dtype: object\n\n\nAt deeper levels (notice in the above table ContractFolderID is nested inside ContractFolderStatus)\n\nhierarchical_df.xs('ContractFolderID', axis=1, level=1)\n\n\n\n\n\n  \n    \n      \n      ContractFolderStatus\n    \n    \n      \n      \n    \n    \n      \n      \n    \n    \n      \n      \n    \n    \n      \n      \n    \n  \n  \n    \n      0\n      C. 2-2021\n    \n    \n      1\n      8128_3/2021\n    \n    \n      2\n      1000_0005-CP01-2021-000063\n    \n    \n      3\n      1379/2020 4738\n    \n    \n      4\n      2021-44\n    \n    \n      ...\n      ...\n    \n    \n      112\n      1005_391-2021\n    \n    \n      113\n      8165_3/2021\n    \n    \n      114\n      8113_3/2021\n    \n    \n      115\n      8113_01 2021\n    \n    \n      116\n      0001264/2021\n    \n  \n\n117 rows × 1 columns\n\n\n\nThe latter encompasses most of the data\n\nhierarchical_df.xs('ContractFolderStatus', axis=1)\n\n\n\n\n\n  \n    \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      ProcurementProject\n      LocatedContractingParty\n      TenderingProcess\n      TenderResult\n    \n    \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      TypeCode\n      BudgetAmount\n      RequiredCommodityClassification\n      ...\n      Attachment\n      ID\n      Attachment\n      PlannedPeriod\n      Party\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      AwardedTenderedProject\n    \n    \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      \n      EstimatedOverallContractAmount\n      TaxExclusiveAmount\n      ItemClassificationCode\n      ...\n      ExternalReference\n      \n      ExternalReference\n      StartDate\n      EndDate\n      PartyIdentification\n      ParentLocatedParty\n      EndDate\n      EndTime\n      ProcurementProjectLotID\n    \n    \n      \n      \n      \n      \n      Name\n      Name\n      \n      \n      \n      \n      \n      ...\n      URI\n      \n      URI\n      \n      \n      ID\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n  \n  \n    \n      0\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      1\n      135553.26\n      135553.26\n      34928530\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      3\n      81022.72\n      81022.72\n      45000000\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2\n      1000_0005-CP01-2021-000063\n      EV\n      NaN\n      El Director General de Comunicación y Relacion...\n      Departamento de Presidencia, Igualdad, Función...\n      Contrato del servicio de realización de labore...\n      2\n      239797.5\n      47959.5\n      92400000\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3\n      1379/2020 4738\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Canet de Mar\n      Entitats municipals de Catalunya\n      Obres de renovació de l'enllumenat públic a la...\n      3\n      214781.46\n      178984.55\n      45316100\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      4\n      2021-44\n      EV\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Valls\n      Entitats municipals de Catalunya\n      Subministre i la instal·lació fotovoltaica en ...\n      1\n      129247.06\n      107642.2\n      9331000\n      ...\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Enllac plec clausules tecniques.doc\n      https://contractaciopublica.gencat.cat/ecofin_...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n      ...\n    \n    \n      112\n      1005_391-2021\n      PUB\n      NaN\n      Dirección General de Cultura-Institución Prínc...\n      Departamento de Cultura, Deporte y Juventud\n      Apoyo a la gestión del patrimonio filmográfico...\n      2\n      104025.9\n      34675.3\n      92511000\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      113\n      8165_3/2021\n      EV\n      NaN\n      Mancomunidad de Servicios Sociales de Base de ...\n      MANCOMUNIDAD DE SERVICIOS DE HUARTE Y DE ESTER...\n      Asistencia técnica para la prestación del serv...\n      2\n      72000\n      14400\n      85000000\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      114\n      8113_3/2021\n      EV\n      NaN\n      Subdirector de Gestión y Recursos\n      Agencia Navarra para la Dependencia\n      Contrato de servicios de desinfección, desinse...\n      2\n      20305.6\n      4061.12\n      90920000\n      ...\n      NaN\n      NaN\n      NaN\n      2022-01-01\n      2022-12-31\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      115\n      8113_01 2021\n      EV\n      NaN\n      Agencia Navarra de Autonomía y Desarrollo de l...\n      Agencia Navarra para la Dependencia\n      Contrato del Servicio de Teleasistencia para l...\n      2\n      11855331.61\n      10777574.19\n      [85320000, 32500000]\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      116\n      0001264/2021\n      RES\n      NaN\n      Agencia Pública Empresarial Sanitaria Bajo Gua...\n      Junta de Andalucía\n      2021/pa-44-4 servicio de mantenimiento integra...\n      2\n      91979.14\n      19162.32\n      33100000\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n117 rows × 34 columns"
  },
  {
    "objectID": "hierarchical.html#util",
    "href": "hierarchical.html#util",
    "title": "hier",
    "section": "Util",
    "text": "Util\nA function to produce a full index path from the upper levels. NOTE: it turns out that when loading a pd.DataFrame saved in parquet format (using to_parquet), np.nan (a float) in a multiindexed column becomes nan (a string). This is accounted for in the code below.\n\nsource\n\npad_col_levels\n\n pad_col_levels (df:pandas.core.frame.DataFrame, levels:tuple|list,\n                 denan:bool=False)\n\nA tuple representing column multiindex is built\n\ncol_index = pad_col_levels(hierarchical_df, ['ContractFolderStatus', 'LocatedContractingParty', 'Party', 'PartyName', 'Name'] )\ncol_index\n\n('ContractFolderStatus',\n 'LocatedContractingParty',\n 'Party',\n 'PartyName',\n 'Name',\n '')\n\n\nnan’s can be omitted by passing the corresponding parameter\n\npad_col_levels(hierarchical_df, ['ContractFolderStatus', 'LocatedContractingParty', 'Party', 'PartyName', 'Name', np.nan, np.nan], denan=True)\n\n('ContractFolderStatus',\n 'LocatedContractingParty',\n 'Party',\n 'PartyName',\n 'Name',\n '')\n\n\nIt is used to retrieve the corresponding column\n\nhierarchical_df.loc[:, col_index]\n\n0                               Ajuntament de Sant Ramon\n1                                 Pleno del Ayuntamiento\n2      El Director General de Comunicación y Relacion...\n3                             Ajuntament de Canet de Mar\n4                                    Ajuntament de Valls\n                             ...                        \n112    Dirección General de Cultura-Institución Prínc...\n113    Mancomunidad de Servicios Sociales de Base de ...\n114                    Subdirector de Gestión y Recursos\n115    Agencia Navarra de Autonomía y Desarrollo de l...\n116    Agencia Pública Empresarial Sanitaria Bajo Gua...\nName: (ContractFolderStatus, LocatedContractingParty, Party, PartyName, Name, ), Length: 117, dtype: object\n\n\nA function returning the columns containing a given substring in their (multi-level) name\n\nsource\n\n\ncolumns_containing\n\n columns_containing (df:pandas.core.frame.DataFrame, substring:str)\n\n\ncolumns_containing(hierarchical_df, 'Name')\n\nMultiIndex([('ContractFolderStatus', 'LocatedContractingParty', ...),\n            ('ContractFolderStatus', 'LocatedContractingParty', ...),\n            ('ContractFolderStatus',      'ProcurementProject', ...),\n            ('ContractFolderStatus',            'TenderResult', ...),\n            ('ContractFolderStatus',         'ValidNoticeInfo', ...),\n            ('ContractFolderStatus', 'LocatedContractingParty', ...)],\n           )\n\n\n\n\nFlattening and renaming columns\nThe above pd.DataFrame with multiindexed columns\n\nhier_df = flat_df_to_multiindexed_df(df)\nhier_df.head(2)\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      ContractFolderStatus\n    \n    \n      \n      \n      \n      \n      \n      ContractFolderID\n      ContractFolderStatusCode\n      LocatedContractingParty\n      ProcurementProject\n      ...\n      LegalDocumentReference\n      TechnicalDocumentReference\n      ProcurementProject\n      LocatedContractingParty\n      TenderingProcess\n      TenderResult\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      BuyerProfileURIID\n      Party\n      ParentLocatedParty\n      Name\n      ...\n      Attachment\n      ID\n      Attachment\n      PlannedPeriod\n      Party\n      ParentLocatedParty\n      ParticipationRequestReceptionPeriod\n      AwardedTenderedProject\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      PartyName\n      PartyName\n      \n      ...\n      ExternalReference\n      \n      ExternalReference\n      StartDate\n      EndDate\n      PartyIdentification\n      ParentLocatedParty\n      EndDate\n      EndTime\n      ProcurementProjectLotID\n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      Name\n      Name\n      \n      ...\n      URI\n      \n      URI\n      \n      \n      ID\n      PartyName\n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      ...\n      \n      \n      \n      \n      \n      \n      Name\n      \n      \n      \n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n2 rows × 38 columns\n\n\n\nA mapping between columns and human-readable fields can be found here. The latter was processed in naming.ipynb to get the file below.\n\ndata_scheme_file = directory / 'PLACE.yaml'\nassert data_scheme_file.exists()\ndata_scheme_file\n\nPosixPath('/home/manu/Sync/UC3M/proyectos/2022/nextProcurement/sproc/samples/PLACE.yaml')\n\n\nIt provides (as a dict) a mapping from human-readable names to (maybe nested) fields in Atom files\n\nwith open(data_scheme_file) as yaml_data:\n    data_scheme = yaml.load(yaml_data, Loader=yaml.FullLoader)\n{k: data_scheme[k] for k in list(data_scheme)[:5]}\n\n{'id': ['id', nan, nan, nan, nan, nan, nan],\n 'summary': ['summary', nan, nan, nan, nan, nan, nan],\n 'title': ['title', nan, nan, nan, nan, nan, nan],\n 'updated': ['updated', nan, nan, nan, nan, nan, nan],\n 'Número de Expediente': ['ContractFolderStatus',\n  'ContractFolderID',\n  nan,\n  nan,\n  nan,\n  nan,\n  nan]}\n\n\nA convenience function, n2c (as in “name to column”), to go from human-readable name to actual multiindex column\n\nn2c = lambda n: pad_col_levels(hier_df, data_scheme[n], denan=True)\n\nThe mapping can be exploited to access the columns of the pd.DataFrame using more natural names\n\nhier_df[n2c('Número de Expediente')]\n\n0                       C. 2-2021\n1                     8128_3/2021\n2      1000_0005-CP01-2021-000063\n3                  1379/2020 4738\n4                         2021-44\n                  ...            \n112                 1005_391-2021\n113                   8165_3/2021\n114                   8113_3/2021\n115                  8113_01 2021\n116                  0001264/2021\nName: (ContractFolderStatus, ContractFolderID, , , , ), Length: 117, dtype: object\n\n\nA hierarchical column multiindex is assumed.\n\ninv_data_scheme = {''.join([e if pd.notna(e) else '' for e in v]): k for k, v in data_scheme.items()}\n[k for k in itertools.islice(inv_data_scheme, 4, 6)]\n\n['ContractFolderStatusContractFolderID',\n 'ContractFolderStatusContractFolderStatusCode']\n\n\n\n('id', '', '', '', '', '') in inv_data_scheme\n\nFalse\n\n\n\nhier_df.columns.nlevels\n\n6\n\n\n\n''.join(hier_df.columns[0])\n\n'id'\n\n\nA tiny function to ensure some data scheme is valid\n\n_data_scheme_ok(data_scheme)\n\nTrue\n\n\n\nimport copy\n\nA data scheme with the wrong number of elements\n\ninvalid_data_scheme = copy.deepcopy(data_scheme)\ninvalid_data_scheme['id'].append(np.nan)\nlen(invalid_data_scheme['id']), len(invalid_data_scheme['summary'])\n\n(8, 7)\n\n\n\n_data_scheme_ok(inv_data_scheme)\n\nFalse\n\n\nA data scheme with the wrong type\n\ninvalid_data_scheme = copy.deepcopy(data_scheme)\ninvalid_data_scheme['id'].append(2)\n\n\n_data_scheme_ok(inv_data_scheme)\n\nFalse\n\n\nA function to rename every multi-indexed column using the provided mapping (data_scheme).\n\nsource\n\n\nflatten_columns_names\n\n flatten_columns_names (df:pandas.core.frame.DataFrame, data_scheme:dict,\n                        inplace:bool=False)\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ndf\nDataFrame\n\nInput\n\n\ndata_scheme\ndict\n\nEvery key is a flattened name, and every value a list with the different levels of the multi-index\n\n\ninplace\nbool\nFalse\nIf True the input DataFrame is modified\n\n\nReturns\nNone | pandas.core.frame.DataFrame\n\nFlat DataFrame\n\n\n\n\nrenamed_cols_df = flatten_columns_names(hier_df, data_scheme)\nrenamed_cols_df.head(2)\n\n\n\n\n\n  \n    \n      \n      id\n      summary\n      title\n      updated\n      Número de Expediente\n      Estado\n      URL perfil de contratante\n      Nombre\n      Ubicación orgánica\n      Objeto del Contrato\n      ...\n      Pliego de cláusulas administrativas (URI)\n      Pliego de Prescripciones técnicas\n      Pliego de Prescripciones técnicas (URI)\n      Plazo de Ejecución (Comienzo)\n      Plazo de Ejecución (Fin)\n      ID\n      ContractFolderStatus - LocatedContractingParty - ParentLocatedParty - ParentLocatedParty - PartyName - Name\n      Presentación de Solicitudes (Fecha)\n      Presentación de Solicitudes (Hora)\n      Lote\n    \n  \n  \n    \n      0\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: C. 2-2021; Órgano de Contrataci...\n      L'objecte del contracte és la renovació de tot...\n      2022-01-03T01:11:41.826+01:00\n      C. 2-2021\n      ADJ\n      https://contractaciopublica.gencat.cat/ecofin_...\n      Ajuntament de Sant Ramon\n      Entitats municipals de Catalunya\n      L'objecte del contracte és la renovació de tot...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1\n      https://contrataciondelestado.es/sindicacion/P...\n      Id licitación: 8128_3/2021; Órgano de Contrata...\n      Obras de restauración hidromorfológica del río...\n      2022-01-03T01:00:11.194+01:00\n      8128_3/2021\n      PUB\n      NaN\n      Pleno del Ayuntamiento\n      AYUNTAMIENTO DE MONREAL\n      Obras de restauración hidromorfológica del río...\n      ...\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n2 rows × 38 columns\n\n\n\nOne can now used the human-readable columns names, e.g.\n\nrenamed_cols_df['Número de Expediente']\n\n0                       C. 2-2021\n1                     8128_3/2021\n2      1000_0005-CP01-2021-000063\n3                  1379/2020 4738\n4                         2021-44\n                  ...            \n112                 1005_391-2021\n113                   8165_3/2021\n114                   8113_3/2021\n115                  8113_01 2021\n116                  0001264/2021\nName: Número de Expediente, Length: 117, dtype: object"
  }
]